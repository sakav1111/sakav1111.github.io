<!DOCTYPE html><html lang="en">
  <head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>SatyaCodes - Jenkins – Jenkins Pipeline for SpringBoot Application JFrog + Docker + Kubernetes + Azure ACS & AKS</title>

<meta name="description" content="Jenkins – Jenkins Pipeline for SpringBoot Application JFrog + Docker + Kubernetes + Azure ACS &amp; AKS1.Configure SpringBoot ProjectWe have SpringBoot appli...">
<link rel="canonical" href="/Jenkins-Pipeline-for-SpringBoot-Application-JFrog-Docker-Kubernetes-Azure-ACS-AKS.html"><link rel="alternate" type="application/rss+xml" title="SatyaCodes" href="/feed.xml"><!-- start favicons snippet, use https://realfavicongenerator.net/ --><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="manifest" href="/assets/site.webmanifest"><link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#fc4d50"><link rel="shortcut icon" href="/assets/favicon.ico">

<meta name="msapplication-TileColor" content="#ffc40d"><meta name="msapplication-config" content="/assets/browserconfig.xml">

<meta name="theme-color" content="#ffffff">
<!-- end favicons snippet -->
 <link rel="stylesheet" href="/assets/css/main.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" >
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Jenkins – Jenkins Pipeline for SpringBoot Application JFrog + Docker + Kubernetes + Azure ACS &amp; AKS | SatyaCodes</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Jenkins – Jenkins Pipeline for SpringBoot Application JFrog + Docker + Kubernetes + Azure ACS &amp; AKS" />
<meta name="author" content="Satya Kaveti" />
<meta property="og:locale" content="en" />
<meta name="description" content="Jenkins – Jenkins Pipeline for SpringBoot Application JFrog + Docker + Kubernetes + Azure ACS &amp; AKS 1.Configure SpringBoot Project We have SpringBoot application in Github. https://github.com/smlcodes/Docker-SpringBoot-EmployeeServices.git we have removed MySQL dependency from docker because we do not require separate MySQL instance for each Image. Build &amp; Run the GitHub code. 2.Create MySQL Database in Azure https://docs.microsoft.com/en-us/azure/mysql/quickstart-create-mysql-server-database-using-azure-portal 3.Manual Docker Image for SpringBoot Project To containerize an application, we enclose our application inside a container image and publish that image to a shared registry. The container runtime pulls this image from the registry, unpacks the image, and runs the application inside it. a. Building a Container Image the Conventional Way 1.Creating a Dockerfile A Dockerfile is a plain text file that contains instructions from which a Docker image is built. Create a Dockerfile in the project’s root folder. A Dockerfile contains the commands below. FROM: directive sets the image on which the container will be based on. RUN: executes commands in the container. COPY: creates a copy of files from the file system in the container. CMD: sets the executable commands within the container. # Image based on JAVA Container FROM openjdk:8-jdk-alpine ARG JAR_FILE=target/*.jar COPY ${JAR_FILE} Docker-EmployeeServices-1.0.jar EXPOSE 8080 ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/Docker-EmployeeServices-1.0.jar&quot;] 2.Building the Application We first build the application with Maven. This creates an executable JAR of the application. We need to convert this executable JAR into a Docker image for running in a Docker engine. mvn clean package 3. Building the Container Image We need to create Docker image from jar file by running docker build -t Repository:TAGVERSION docker build -t employeeservices:latest . We can see our image listed with the command: docker images 4.Viewing the Layers Inside the Container Image We will use the dive tool to view check layers inside the image. using dive Repository:TAGVERSION 5.Running Docker Image docker run --name employeeservices -d -p 8080:8080 employeeservices:latest 6.Execute the command below to list all the running Docker containers. docker container ps 7.Access Running application by docker URL b. Building Using Maven By using Maven, we have multiple options. Using the integrated Spring Boot build-image goal. Using the jib-maven-plugin from Google. Using the dockerfile-maven-plugin from Spotify. 1.Using the integrated Spring Boot build-image goal. Spring Boot comes pre-shipped with its own plugin for building Docker images and you don’t need to make any changes. It is available through the standard spring-boot-starter-parent that is included in your pom.xml. you do not need to write a Dockerfile either and the plugin takes care of Spring-recommended security, memory, and performance optimizations. if there is a Dockerfile located within your source code repository, it will be ignored. To create Docker image, just run mvn spring-boot:build-image make sure project name must be on small letters &amp; no special symbols 2. Using the jib-maven-plugin from Google Jib is a Maven and Gradle plugin for creating Docker images for Java applications. it does not require Docker to be installed locally it does not require you to have written a Dockerfile Best Choice for Continuous Integration / build server jib-maven-plugin will build and push the image straight to the Docker registry of choice. **Using Local System** Since we are not pushing to a Docker registry, we will tell Jib to use our local Docker installation by using the dockerBuild goal. pom.xml &lt;plugin&gt; &lt;groupId&gt;com.google.cloud.tools&lt;/groupId&gt; &lt;artifactId&gt;jib-maven-plugin&lt;/artifactId&gt; &lt;version&gt;2.6.0&lt;/version&gt; &lt;configuration&gt; &lt;from&gt; &lt;image&gt;gcr.io/distroless/java:8&lt;/image&gt; &lt;/from&gt; &lt;to&gt; &lt;image&gt;docker-employeeservices:${project.version}&lt;/image&gt; &lt;/to&gt; &lt;/configuration&gt; &lt;/plugin&gt; # Builds to a container image and pushes registry. $ mvn compile jib:build # Builds to a Docker daemon in local system. $ mvn compile jib:dockerBuild # This builds and saves your image as tarball to target/jib-image.tar $ mvn compile jib:buildTar # you can load tar Image into docker with docker load --input target/jib-image.tar $ The only configuration we needed is to provide was &lt;to&gt;&lt;image&gt;, which is the name of our Docker image. We can now use that plugin to create a Docker image that will be available on our local Docker daemon. To build the Docker image, run the command, without maven dependency in pom.xml mvn compile com.google.cloud.tools:jib-maven-plugin:2.3.0:dockerBuild **Using DockerHub** 1.add registry credentials to the Maven Maven\conf\settings.xml file &lt;server&gt; &lt;id&gt;registry.hub.docker.com&lt;/id&gt; &lt;username&gt;smlcodes&lt;/username&gt; &lt;password&gt;passw0rd@&lt;/password&gt; &lt;/server&gt; 2.Update pom.xml &lt;plugin&gt; &lt;groupId&gt;com.google.cloud.tools&lt;/groupId&gt; &lt;artifactId&gt;jib-maven-plugin&lt;/artifactId&gt; &lt;version&gt;2.6.0&lt;/version&gt; &lt;configuration&gt; &lt;from&gt; &lt;image&gt;gcr.io/distroless/java:8&lt;/image&gt; &lt;/from&gt; &lt;to&gt; &lt;image&gt;smlcodes/docker-employeeservices:${project.version}&lt;/image&gt; &lt;/to&gt; &lt;/configuration&gt; &lt;/plugin&gt; Typically, you don’t need to provide &lt;from&gt; as by default, as it uses a distro-less Java 8 image. However, I have used Java 11, so I have explicitly mentioned that here. Moreover, depending on your use case, you may want to use a different base image &lt;image&gt; This refers to the target image that will pushed to the container registry. To Build &amp; Publish docker image mvn compile jib:build Check Docker HUB online I have used a Docker registry, but you can use any cloud provider’s (ECS, GCR, ACR) container registry. For other options available for use with the plugin, you can refer to the documentation. 3.Using the dockerfile-maven-plugin Add your Dockerfile into your root directory alongside your pom.xml. &lt;plugin&gt; &lt;groupId&gt;com.spotify&lt;/groupId&gt; &lt;artifactId&gt;dockerfile-maven-plugin&lt;/artifactId&gt; &lt;version&gt;1.4.13&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;default&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;build&lt;/goal&gt; &lt;goal&gt;push&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;configuration&gt; &lt;repository&gt;${project.artifactId}&lt;/repository&gt; &lt;tag&gt;${project.version}&lt;/tag&gt; &lt;buildArgs&gt; &lt;JAR_FILE&gt;target/${project.build.finalName}.jar&lt;/JAR_FILE&gt; &lt;/buildArgs&gt; &lt;/configuration&gt; &lt;/plugin&gt; 4.Jenkins Configuration Downoad &amp; Start Jenkins from here cd C:\Docker\Jenkins java -jar jenkins.war --httpPort=2222 echo &quot;Jenkins Started . . . &quot; Login to Jenkins http://localhost:2222/ admin/admin 5.Docker Image PUSH to JFrog Artifactory Go to JFrog Website: https://jfrog.com/start-free create an account, login On your system cmdline docker login satyajohnny.jfrog.io From next time onwards it won’t ask for Credentials Go to Administration &gt; Add Repository &gt; Local &gt; Select : Docker &gt; Name : jenkins-docker-images To Integrate with Jenkins, follow http://satyacodes.ml/jenkins/jfrog-integration pipeline { agent tools { //Java, Maven Configured in Globol tools configuration. and here the names we provided for configuration &#39;Java8&#39; &#39;Maven&#39; } stages { stage (&#39;Clone&#39;) { steps { //github-creds are github login creds, configured in Credencial Manager git branch: &#39;main&#39;, credentialsId: &#39;github-creds&#39;, url: &#39;https://github.com/smlcodes/Docker-SpringBoot-EmployeeServices.git&#39; } } /* Artifactory-1 - similarly like Globol tool configuration. But we are configured manually, passed as ServerID rtMavenResolver - To get Jars of Pom.xml rtMavenDeployer - To Deploy Newly created jars on Build */ stage (&#39;Artifactory Configuration&#39;) { steps { rtServer ( : &#39;Artifactory-1&#39;, url: &quot;https://satyajohnny.jfrog.io/artifactory&quot;, credentialsId: &quot;jfrog-creds&quot; ) rtMavenResolver ( : &#39;maven-resolver&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release&#39;, snapshotRepo: &#39;libs-release-libs-snapshot&#39; ) rtMavenDeployer ( : &#39;maven-deployer&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release-local&#39;, snapshotRepo: &#39;libs-release-libs-snapshot-local&#39;, threads: 6 ) } } stage(&#39;Build Maven Project&#39;) { steps { rtMavenRun ( tool: &#39;Maven&#39;, pom: &#39;pom.xml&#39;, goals: &#39;-X clean install&#39;, deployerId: &quot;maven-deployer&quot;, resolverId: &quot;maven-resolver&quot; ) } } } } After Running this New jars added to JFrog Artifactory 5.Docker Image Push to Docker HUB First, create a environment to save docker image information’s. dockerImage = &#39;&#39; Change the build stage to save build information in environment. dockerImage = docker.build registry + &quot;:$BUILD_NUMBER&quot; pipeline { environment { registry = &quot;smlcodes/docker-employeeservices&quot; registryCredential = &#39;docker-creds&#39; dockerImage = &#39;&#39; } agent tools { &#39;Java8&#39; &#39;Maven&#39; } stages { stage(&#39;Clone&#39;) { steps { git branch: &#39;main&#39;, credentialsId: &#39;github-creds&#39;, url: &#39;https://github.com/smlcodes/docker-springboot-employeeservices.git&#39; } } /* Artifactory-1 - similarly like Globol tool configuration. But we are configured manually, passed as ServerID rtMavenResolver - To get Jars of Pom.xml rtMavenDeployer - To Deploy Newly created jars on Build */ stage(&#39;Artifactory Configuration&#39;) { steps { rtServer( : &#39;Artifactory-1&#39;, url: &quot;https://satyajohnny.jfrog.io/artifactory&quot;, credentialsId: &quot;jfrog-creds&quot; ) rtMavenResolver( : &#39;maven-resolver&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release&#39;, snapshotRepo: &#39;libs-release-libs-snapshot&#39; ) rtMavenDeployer( : &#39;maven-deployer&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release-local&#39;, snapshotRepo: &#39;libs-release-libs-snapshot-local&#39;, threads: 6 ) } } stage(&#39;Build Maven Project&#39;) { steps { rtMavenRun( tool: &#39;Maven&#39;, pom: &#39;pom.xml&#39;, goals: &#39;-U clean install&#39;, deployerId: &quot;maven-deployer&quot;, resolverId: &quot;maven-resolver&quot; ) } } stage(&#39;Build Docker Image&#39;) { steps { &quot;\n \n \n \n ***************************************&quot; &quot; Build Docker Image&quot; &quot;***************************************\n \n \n&quot; script { docker.build(&quot;satyajohnny.jfrog.io/&quot; + &quot;docker-employeeservices:2.0.${env.BUILD_NUMBER}&quot;) dockerImage = docker.build registry + &quot;:$BUILD_NUMBER&quot; } } } stage(&#39;Push Image to DockerHub&#39;) { steps { script { &quot;\n \n \n \n ***************************************&quot; &quot; Push Image to DockerHub&quot; &quot;*********************************\n \n \n&quot; docker.withRegistry(&#39;&#39;, registryCredential) { dockerImage.push() } } } } } //Stages End } //Pipeline End 5.Docker Image Push to Azure Container Registry To Quick start Azure Container Registry follow https://docs.microsoft.com/en-us/azure/container-registry/container-registry-get-started-portal Select Create a resource &gt; Containers &gt; Container Registry. Go to Access Keys in Container Registry and enable the admin user, then use the autogenerated credentials to login via Docker Configure these credentials in Jenkins with name &#39;azurecontainer-creds&#39; pipeline { environment { dockerregistry = &quot;smlcodes/docker-employeeservices&quot; dockercreds = &#39;docker-creds&#39; dockerHubImage = &#39;&#39; //Go to Access Keys in Container Registry and enable the admin user, then use the autogenerated credentials to login via Docker azureregistry = &quot;satyajohnnycontainer.azurecr.io&quot; azurecreds = &#39;azurecontainer-creds&#39; azureImage = &#39;&#39; } agent tools { &#39;Java8&#39; &#39;Maven&#39; } stages { stage(&#39;Clone&#39;) { steps { git branch: &#39;main&#39;, credentialsId: &#39;github-creds&#39;, url: &#39;https://github.com/smlcodes/docker-springboot-employeeservices.git&#39; } } stage(&#39;Artifactory Configuration&#39;) { steps { rtServer( : &#39;Artifactory-1&#39;, url: &quot;https://satyajohnny.jfrog.io/artifactory&quot;, credentialsId: &quot;jfrog-creds&quot; ) rtMavenResolver( : &#39;maven-resolver&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release&#39;, snapshotRepo: &#39;libs-release-libs-snapshot&#39; ) rtMavenDeployer( : &#39;maven-deployer&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release-local&#39;, snapshotRepo: &#39;libs-release-libs-snapshot-local&#39;, threads: 6 ) } } stage(&#39;Build Maven Project&#39;) { steps { rtMavenRun( tool: &#39;Maven&#39;, pom: &#39;pom.xml&#39;, goals: &#39;-U clean install&#39;, deployerId: &quot;maven-deployer&quot;, resolverId: &quot;maven-resolver&quot; ) } } stage(&#39;Build Docker Image&#39;) { steps { script { azureImage = docker.build(&quot;satyajohnnycontainer.azurecr.io/&quot; + &quot;docker-employeeservices:2.0.${env.BUILD_NUMBER}&quot;) } } } stage(&#39;Push Image to Azure Container Registry&#39;) { steps { script { docker.withRegistry(&#39;https://satyajohnnycontainer.azurecr.io&#39;, azurecreds) { azureImage.push() } } } } stage (&#39;Publish Build Info&#39;) { steps { rtPublishBuildInfo ( serverId: &quot;Artifactory-1&quot; ) } } } //Stages End } //Pipeline End Now go to Azure Container Registry &gt; Services &gt; Repository , see Docker Image published #Login az acr login --name satyajohnnycontainer #List images in registry az acr repository list --name satyajohnnycontainer --output table 6.AKS – Azure Kubernetes Service AKS is a managed Kubernetes service that lets you quickly deploy and manage clusters. We will see how to create AKS cluster in Azure cloud using Azure CLI. Pre-requisites: Azure CLI is installed on your local machine. Account setup in Azure. Create Azure Container Registry #Login to Azure az login #Create a resource group first. az group create --name myResourceGroup --location eastus Run the below command to create your own private container registry using Azure Container Registry az acr create --resource-group myResourceGroup --name satyajohnnycontainer --sku Standard --location eastus Create AKS cluster with 2 worker nodes az aks create --resource-group myResourceGroup --name --node-count 2 --enable-addons monitoring --generate-ssh-keys C:\Windows\system32&gt; --resource-group myResourceGroup --name --node-count 2 --enable-addons monitoring --generate-ssh-keys SSH key files &#39;C:\Users\kavetis\.ssh\id_rsa&#39; and &#39;C:\Users\kavetis\.ssh\id_rsa.pub&#39; have been generated under ~/.ssh to allow SSH access to the VM. If using machines without permanent storage like Azure Cloud Shell without an attached file share, back up your keys to a safe location Resource provider &#39;Microsoft.OperationalInsights&#39; used by this operation is not registered. We are registering for you. Once Above cmd run completes, we can see many no. of services are created which are required by AKS. We can see 2 Nodes inside AKS Cluster Connect to the cluster az aks get-credentials --resource-group myResourceGroup --name --overwrite-existing To verify the connection to your cluster, use the kubectl get command to return a list of the cluster nodes. kubectl get nodes # List all deployments in a specific namespace kubectl get deployments --all-namespaces=true Update Jenkins Pipeline pipeline { agent environment { registry = &quot;smlcodes/docker-employeeservices&quot; registryCredential = &#39;docker-creds&#39; dockerImage = &#39;&#39; } stages { stage(&#39;checkout&#39;) { steps { git branch: &#39;main&#39;, credentialsId: &#39;github-creds&#39;, url: &#39;https://github.com/smlcodes/docker-springboot-employeeservices.git&#39; } } stage(&#39;Artifactory Configuration&#39;) { steps { rtServer( : &#39;Artifactory-1&#39;, url: &quot;https://satyajohnny.jfrog.io/artifactory&quot;, credentialsId: &quot;jfrog-creds&quot; ) rtMavenResolver( : &#39;maven-resolver&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release&#39;, snapshotRepo: &#39;libs-release-libs-snapshot&#39; ) rtMavenDeployer( : &#39;maven-deployer&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release-local&#39;, snapshotRepo: &#39;libs-release-libs-snapshot-local&#39;, threads: 6 ) } } stage(&#39;Build Maven Project&#39;) { steps { rtMavenRun( tool: &#39;Maven&#39;, pom: &#39;pom.xml&#39;, goals: &#39;-U clean install&#39;, deployerId: &quot;maven-deployer&quot;, resolverId: &quot;maven-resolver&quot; ) } } stage(&#39;Build Docker image&#39;) { steps { script { dockerImage = docker.build registry + &quot;:$BUILD_NUMBER&quot; } } } // Uploading Docker images into Docker Hub stage(&#39;Upload Image to Docker HUB&#39;) { steps { script { docker.withRegistry(&#39;&#39;, registryCredential) { dockerImage.push() dockerImage.push(&#39;latest&#39;) } } } } stage(&#39;Remove Unused docker image&#39;) { steps { &quot;docker rmi $registry:$BUILD_NUMBER&quot; } } stage(&#39;K8S Deploy&#39;) { steps { script { kubernetesDeploy( configs: &#39;Kubernetes.yaml&#39;, kubeconfigId: &#39;aks-creds&#39;, enableConfigSubstitution: true ) } } } } } always { // remove built docker image and prune system print &#39;Cleaning up the Docker system.&#39; &#39;docker system prune -f&#39; } Kubernetes.yaml – For Docker HUB apiVersion: apps/v1 kind: Deployment metadata: name: docker-employeeservices-manual spec: replicas: 2 selector: matchLabels: app: docker-employeeservices-manual template: metadata: labels: app: docker-employeeservices-manual spec: containers: - name: docker-employeeservices-manual image: smlcodes/docker-employeeservices # image: wingtiptoysregistry.azurecr.io/gs-spring-boot-docker:latest --- apiVersion: v1 kind: Service metadata: name: docker-employeeservices-manual-service spec: type: LoadBalancer ports: - port: 80 targetPort: 8080 selector: app: docker-employeeservices-manual Build Pipeline Build Is Success, But if you see AKS Cluster it is unable to Pull the Image Here we can see that AKS is not able to pull image from ACR. Let’s describe the pod and look for more information. kubectl get pods docker-employeeservices-acs-86b4879d-7h5x5 0/1 ImagePullBackOff 0 16h docker-employeeservices-acs-86b4879d-b4zc2 0/1 ImagePullBackOff 0 16h kubectl describe pods docker-employeeservices-acs-86b4879d-7h5x5 Here the Problem is ACS &amp; AKS Integration. For that we need to run below command az aks update -n myAKSCluster -g myResourceGroup --attach-acr &lt;acr-name&gt; az aks update -n satyajohnnyAKSCluster -g myResourceGroup --attach-acr satyajohnnycontainer When we attach ACR to AKS, it actually grants the ‘acrpull’ role assignment to ACR specified by name or resource ID. Check Integration Status az aks check-acr --name satyajohnnyAKSCluster --resource-group myResourceGroup \--acr satyajohnnycontainer.azurecr.io Re-Run Pipeline Again. 7. Verify deployments to K8S kubectl get pods kubectl get deployments kubectl get services Here External-IP is the Public IP Where we can access Our Application. You can also get from UI, Go to AKS Portal in below Image Check Pods are Running open public IP without port 8. Final Working Pipeline Code // Dockerfile # Image based on JAVA Container FROM openjdk:8-jdk-alpine ARG JAR_FILE=target/*.jar COPY ${JAR_FILE} Docker-EmployeeServices-2.0.jar EXPOSE 8080 ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/Docker-EmployeeServices-2.0.jar&quot;] // Jenkinsfile pipeline { environment { dockerregistry = &quot;smlcodes/docker-employeeservices&quot; dockercreds = &#39;docker-creds&#39; dockerHubImage = &#39;&#39; //Go to Access Keys in Container Registry and enable the admin user, then use the autogenerated credentials to login via Docker azureregistry = &quot;satyajohnnycontainer.azurecr.io&quot; azurecreds = &#39;azurecontainer-creds&#39; azureImage = &#39;&#39; } agent tools { //Java, Maven Configured in Globol tools configuration. and here the names we provided for configuration &#39;Java8&#39; &#39;Maven&#39; } stages { stage(&#39;Clone&#39;) { steps { //github-creds are github login creds, configured in Credencial Manager git branch: &#39;main&#39;, credentialsId: &#39;github-creds&#39;, url: &#39;https://github.com/smlcodes/docker-springboot-employeeservices.git&#39; } } /* Artifactory-1 - similarly like Globol tool configuration. But we are configured manually, passed as ServerID rtMavenResolver - To get Jars of Pom.xml rtMavenDeployer - To Deploy Newly created jars on Build */ stage(&#39;Artifactory Configuration&#39;) { steps { rtServer( : &#39;Artifactory-1&#39;, url: &quot;https://satyajohnny.jfrog.io/artifactory&quot;, credentialsId: &quot;jfrog-creds&quot; ) rtMavenResolver( : &#39;maven-resolver&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release&#39;, snapshotRepo: &#39;libs-release-libs-snapshot&#39; ) rtMavenDeployer( : &#39;maven-deployer&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release-local&#39;, snapshotRepo: &#39;libs-release-libs-snapshot-local&#39;, threads: 6 ) } } stage(&#39;Build Maven Project&#39;) { steps { rtMavenRun( tool: &#39;Maven&#39;, pom: &#39;pom.xml&#39;, goals: &#39;-U clean install&#39;, deployerId: &quot;maven-deployer&quot;, resolverId: &quot;maven-resolver&quot; ) } } stage(&#39;Build Docker Image&#39;) { steps { &quot;\n \n \n \n ******************************************************************************&quot; &quot; Build Docker Image&quot; &quot;******************************************************************************\n \n \n&quot; script { //docker.build(&quot;satyajohnny.jfrog.io/&quot; + &quot;docker-employeeservices:2.0.${env.BUILD_NUMBER}&quot;) dockerHubImage = docker.build dockerregistry + &quot;:$BUILD_NUMBER&quot; azureImage = docker.build(&quot;satyajohnnycontainer.azurecr.io/&quot; + &quot;docker-employeeservices:${env.BUILD_NUMBER}&quot;) } } } stage(&#39;Push Image to Azure Container Registry&#39;) { steps { script { &quot;\n \n \n \n ******************************************************************************&quot; &quot; Push Image to Azure Container Registry&quot; &quot;******************************************************************************\n \n \n&quot; docker.withRegistry(&#39;https://satyajohnnycontainer.azurecr.io&#39;, azurecreds) { azureImage.push() azureImage.push(&#39;latest&#39;) } } } } // Uploading Docker images into Docker Hub stage(&#39;Push Image to Docker HUB&#39;) { steps { script { docker.withRegistry(&#39;&#39;, dockercreds) { dockerHubImage.push() dockerHubImage.push(&#39;latest&#39;) } } } } stage(&#39;Remove Unused docker image&#39;) { steps { &quot;docker rmi $dockerregistry:$BUILD_NUMBER&quot; } } // Deploy To Azure Kubernetes Cluster stage(&#39;K8S Deploy&#39;) { steps { script { kubernetesDeploy( configs: &#39;Kubernetes.yaml&#39;, kubeconfigId: &#39;aks-creds&#39;, enableConfigSubstitution: true ) } } } /* Push Image to Artfifactory Not Woking serverId : Configred Artfifactory Server Name host : docker daemon host where Docker currenlty running system/localhost targetRepo : Repo name in Artfifactory */ /* stage (&#39;Push Image to Artifactory&#39;) { steps { echo &quot;\n \n \n \n ******************************************************************************&quot; echo &quot; Not Working on LocalHost : Push Docker Image to Artifactory&quot; echo &quot;******************************************************************************\n \n \n&quot; rtDockerPush( serverId: &quot;Artifactory-1&quot;, image: &quot;satyajohnny.jfrog.io/&quot; + &quot;docker-employeeservices:2.0.${env.BUILD_NUMBER}&quot;, host: &#39;tcp://thedockerhost:2375/&#39;, targetRepo: &#39;jenkins-docker-images&#39;, properties: &#39;project-name=docker-employeeservices:2.0;status=stable&#39; ) } } */ /* stage(&#39;Push Image to DockerHub&#39;) { steps { script { echo &quot;\n \n \n \n ******************************************************************************&quot; echo &quot; Working - Push Image to DockerHub&quot; echo &quot;******************************************************************************\n \n \n&quot; docker.withRegistry(&#39;&#39;, dockercreds) { dockerHubImage.push() } } } } */ } //Stages End } //Pipeline End always { // remove built docker image and prune system print &#39;Cleaning up the Docker system.&#39; &#39;docker system prune -f&#39; } Kubernetes.yaml apiVersion: apps/v1 kind: Deployment metadata: name: docker-employeeservices-acs spec: replicas: 2 selector: matchLabels: app: docker-employeeservices-acs template: metadata: labels: app: docker-employeeservices-acs spec: containers: - name: docker-employeeservices-acs image: satyajohnnycontainer.azurecr.io/docker-employeeservices:latest #image: smlcodes/docker-employeeservices --- apiVersion: v1 kind: Service metadata: name: docker-employeeservices-acs-service spec: type: LoadBalancer ports: - port: 80 targetPort: 8080 selector: app: docker-employeeservices-acs 9. Delete Cluster To avoid Azure charges, you should clean up unneeded resources. When the cluster is no longer needed, use the az group delete command to remove the resource group, container service, and all related resources. az group delete --name myResourceGroup --yes --no-wait Ref. https://www.coachdevops.com/2020/06/deploy-python-app-into-kubernetes.html https://docs.microsoft.com/en-us/azure/mysql/quickstart-create-mysql-server-database-using-azure-portal https://reflectoring.io/spring-boot-docker/ https://medium.com/swlh/build-a-docker-image-using-maven-and-spring-boot-58147045a400 https://medium.com/@gustavo.guss/jenkins-building-docker-image-and-sending-to-registry-64b84ea45ee9 https://docs.microsoft.com/en-us/azure/container-registry/container-registry-get-started-portal https://jfrog.com/blog/ci-cd-side-by-side-jenkins-and-jfrog-pipelines/ https://www.jfrog.com/confluence/display/JFROG/Declarative+Pipeline+Syntax https://technology.amis.nl/languages/java-languages/jenkins-building-java-and-deploying-to-kubernetes/ https://github.com/talitz/spring-petclinic-ci-cd-k8s-example/blob/master/Jenkinsfile https://dzone.com/articles/building-docker-images-to-docker-hub-using-jenkins https://stackoverflow.com/questions/58203820/jenkins-with-jfrog-artifactory-push-docker-images https://stackoverflow.com/questions/50022357/can-not-push-docker-image-to-artifactory-in-jenkins-pipeline-using-artifactory-p https://github.com/dumindarw/reactive-eventservice/blob/master/Jenkinsfile https://github.com/learnk8s/free-kubernetes https://docs.microsoft.com/en-us/azure/architecture/solution-ideas/articles/container-cicd-using-jenkins-and-kubernetes-on-azure-container-service https://ystatit.medium.com/azure-configure-acr-integration-for-existing-aks-cluster-c551c678fede https://github.com/dumindarw/reactive-eventservice/blob/master/Jenkinsfile https://github.com/learnk8s/free-kubernetes https://docs.microsoft.com/en-us/azure/architecture/solution-ideas/articles/container-cicd-using-jenkins-and-kubernetes-on-azure-container-service" />
<meta property="og:description" content="Jenkins – Jenkins Pipeline for SpringBoot Application JFrog + Docker + Kubernetes + Azure ACS &amp; AKS 1.Configure SpringBoot Project We have SpringBoot application in Github. https://github.com/smlcodes/Docker-SpringBoot-EmployeeServices.git we have removed MySQL dependency from docker because we do not require separate MySQL instance for each Image. Build &amp; Run the GitHub code. 2.Create MySQL Database in Azure https://docs.microsoft.com/en-us/azure/mysql/quickstart-create-mysql-server-database-using-azure-portal 3.Manual Docker Image for SpringBoot Project To containerize an application, we enclose our application inside a container image and publish that image to a shared registry. The container runtime pulls this image from the registry, unpacks the image, and runs the application inside it. a. Building a Container Image the Conventional Way 1.Creating a Dockerfile A Dockerfile is a plain text file that contains instructions from which a Docker image is built. Create a Dockerfile in the project’s root folder. A Dockerfile contains the commands below. FROM: directive sets the image on which the container will be based on. RUN: executes commands in the container. COPY: creates a copy of files from the file system in the container. CMD: sets the executable commands within the container. # Image based on JAVA Container FROM openjdk:8-jdk-alpine ARG JAR_FILE=target/*.jar COPY ${JAR_FILE} Docker-EmployeeServices-1.0.jar EXPOSE 8080 ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/Docker-EmployeeServices-1.0.jar&quot;] 2.Building the Application We first build the application with Maven. This creates an executable JAR of the application. We need to convert this executable JAR into a Docker image for running in a Docker engine. mvn clean package 3. Building the Container Image We need to create Docker image from jar file by running docker build -t Repository:TAGVERSION docker build -t employeeservices:latest . We can see our image listed with the command: docker images 4.Viewing the Layers Inside the Container Image We will use the dive tool to view check layers inside the image. using dive Repository:TAGVERSION 5.Running Docker Image docker run --name employeeservices -d -p 8080:8080 employeeservices:latest 6.Execute the command below to list all the running Docker containers. docker container ps 7.Access Running application by docker URL b. Building Using Maven By using Maven, we have multiple options. Using the integrated Spring Boot build-image goal. Using the jib-maven-plugin from Google. Using the dockerfile-maven-plugin from Spotify. 1.Using the integrated Spring Boot build-image goal. Spring Boot comes pre-shipped with its own plugin for building Docker images and you don’t need to make any changes. It is available through the standard spring-boot-starter-parent that is included in your pom.xml. you do not need to write a Dockerfile either and the plugin takes care of Spring-recommended security, memory, and performance optimizations. if there is a Dockerfile located within your source code repository, it will be ignored. To create Docker image, just run mvn spring-boot:build-image make sure project name must be on small letters &amp; no special symbols 2. Using the jib-maven-plugin from Google Jib is a Maven and Gradle plugin for creating Docker images for Java applications. it does not require Docker to be installed locally it does not require you to have written a Dockerfile Best Choice for Continuous Integration / build server jib-maven-plugin will build and push the image straight to the Docker registry of choice. **Using Local System** Since we are not pushing to a Docker registry, we will tell Jib to use our local Docker installation by using the dockerBuild goal. pom.xml &lt;plugin&gt; &lt;groupId&gt;com.google.cloud.tools&lt;/groupId&gt; &lt;artifactId&gt;jib-maven-plugin&lt;/artifactId&gt; &lt;version&gt;2.6.0&lt;/version&gt; &lt;configuration&gt; &lt;from&gt; &lt;image&gt;gcr.io/distroless/java:8&lt;/image&gt; &lt;/from&gt; &lt;to&gt; &lt;image&gt;docker-employeeservices:${project.version}&lt;/image&gt; &lt;/to&gt; &lt;/configuration&gt; &lt;/plugin&gt; # Builds to a container image and pushes registry. $ mvn compile jib:build # Builds to a Docker daemon in local system. $ mvn compile jib:dockerBuild # This builds and saves your image as tarball to target/jib-image.tar $ mvn compile jib:buildTar # you can load tar Image into docker with docker load --input target/jib-image.tar $ The only configuration we needed is to provide was &lt;to&gt;&lt;image&gt;, which is the name of our Docker image. We can now use that plugin to create a Docker image that will be available on our local Docker daemon. To build the Docker image, run the command, without maven dependency in pom.xml mvn compile com.google.cloud.tools:jib-maven-plugin:2.3.0:dockerBuild **Using DockerHub** 1.add registry credentials to the Maven Maven\conf\settings.xml file &lt;server&gt; &lt;id&gt;registry.hub.docker.com&lt;/id&gt; &lt;username&gt;smlcodes&lt;/username&gt; &lt;password&gt;passw0rd@&lt;/password&gt; &lt;/server&gt; 2.Update pom.xml &lt;plugin&gt; &lt;groupId&gt;com.google.cloud.tools&lt;/groupId&gt; &lt;artifactId&gt;jib-maven-plugin&lt;/artifactId&gt; &lt;version&gt;2.6.0&lt;/version&gt; &lt;configuration&gt; &lt;from&gt; &lt;image&gt;gcr.io/distroless/java:8&lt;/image&gt; &lt;/from&gt; &lt;to&gt; &lt;image&gt;smlcodes/docker-employeeservices:${project.version}&lt;/image&gt; &lt;/to&gt; &lt;/configuration&gt; &lt;/plugin&gt; Typically, you don’t need to provide &lt;from&gt; as by default, as it uses a distro-less Java 8 image. However, I have used Java 11, so I have explicitly mentioned that here. Moreover, depending on your use case, you may want to use a different base image &lt;image&gt; This refers to the target image that will pushed to the container registry. To Build &amp; Publish docker image mvn compile jib:build Check Docker HUB online I have used a Docker registry, but you can use any cloud provider’s (ECS, GCR, ACR) container registry. For other options available for use with the plugin, you can refer to the documentation. 3.Using the dockerfile-maven-plugin Add your Dockerfile into your root directory alongside your pom.xml. &lt;plugin&gt; &lt;groupId&gt;com.spotify&lt;/groupId&gt; &lt;artifactId&gt;dockerfile-maven-plugin&lt;/artifactId&gt; &lt;version&gt;1.4.13&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;default&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;build&lt;/goal&gt; &lt;goal&gt;push&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;configuration&gt; &lt;repository&gt;${project.artifactId}&lt;/repository&gt; &lt;tag&gt;${project.version}&lt;/tag&gt; &lt;buildArgs&gt; &lt;JAR_FILE&gt;target/${project.build.finalName}.jar&lt;/JAR_FILE&gt; &lt;/buildArgs&gt; &lt;/configuration&gt; &lt;/plugin&gt; 4.Jenkins Configuration Downoad &amp; Start Jenkins from here cd C:\Docker\Jenkins java -jar jenkins.war --httpPort=2222 echo &quot;Jenkins Started . . . &quot; Login to Jenkins http://localhost:2222/ admin/admin 5.Docker Image PUSH to JFrog Artifactory Go to JFrog Website: https://jfrog.com/start-free create an account, login On your system cmdline docker login satyajohnny.jfrog.io From next time onwards it won’t ask for Credentials Go to Administration &gt; Add Repository &gt; Local &gt; Select : Docker &gt; Name : jenkins-docker-images To Integrate with Jenkins, follow http://satyacodes.ml/jenkins/jfrog-integration pipeline { agent tools { //Java, Maven Configured in Globol tools configuration. and here the names we provided for configuration &#39;Java8&#39; &#39;Maven&#39; } stages { stage (&#39;Clone&#39;) { steps { //github-creds are github login creds, configured in Credencial Manager git branch: &#39;main&#39;, credentialsId: &#39;github-creds&#39;, url: &#39;https://github.com/smlcodes/Docker-SpringBoot-EmployeeServices.git&#39; } } /* Artifactory-1 - similarly like Globol tool configuration. But we are configured manually, passed as ServerID rtMavenResolver - To get Jars of Pom.xml rtMavenDeployer - To Deploy Newly created jars on Build */ stage (&#39;Artifactory Configuration&#39;) { steps { rtServer ( : &#39;Artifactory-1&#39;, url: &quot;https://satyajohnny.jfrog.io/artifactory&quot;, credentialsId: &quot;jfrog-creds&quot; ) rtMavenResolver ( : &#39;maven-resolver&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release&#39;, snapshotRepo: &#39;libs-release-libs-snapshot&#39; ) rtMavenDeployer ( : &#39;maven-deployer&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release-local&#39;, snapshotRepo: &#39;libs-release-libs-snapshot-local&#39;, threads: 6 ) } } stage(&#39;Build Maven Project&#39;) { steps { rtMavenRun ( tool: &#39;Maven&#39;, pom: &#39;pom.xml&#39;, goals: &#39;-X clean install&#39;, deployerId: &quot;maven-deployer&quot;, resolverId: &quot;maven-resolver&quot; ) } } } } After Running this New jars added to JFrog Artifactory 5.Docker Image Push to Docker HUB First, create a environment to save docker image information’s. dockerImage = &#39;&#39; Change the build stage to save build information in environment. dockerImage = docker.build registry + &quot;:$BUILD_NUMBER&quot; pipeline { environment { registry = &quot;smlcodes/docker-employeeservices&quot; registryCredential = &#39;docker-creds&#39; dockerImage = &#39;&#39; } agent tools { &#39;Java8&#39; &#39;Maven&#39; } stages { stage(&#39;Clone&#39;) { steps { git branch: &#39;main&#39;, credentialsId: &#39;github-creds&#39;, url: &#39;https://github.com/smlcodes/docker-springboot-employeeservices.git&#39; } } /* Artifactory-1 - similarly like Globol tool configuration. But we are configured manually, passed as ServerID rtMavenResolver - To get Jars of Pom.xml rtMavenDeployer - To Deploy Newly created jars on Build */ stage(&#39;Artifactory Configuration&#39;) { steps { rtServer( : &#39;Artifactory-1&#39;, url: &quot;https://satyajohnny.jfrog.io/artifactory&quot;, credentialsId: &quot;jfrog-creds&quot; ) rtMavenResolver( : &#39;maven-resolver&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release&#39;, snapshotRepo: &#39;libs-release-libs-snapshot&#39; ) rtMavenDeployer( : &#39;maven-deployer&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release-local&#39;, snapshotRepo: &#39;libs-release-libs-snapshot-local&#39;, threads: 6 ) } } stage(&#39;Build Maven Project&#39;) { steps { rtMavenRun( tool: &#39;Maven&#39;, pom: &#39;pom.xml&#39;, goals: &#39;-U clean install&#39;, deployerId: &quot;maven-deployer&quot;, resolverId: &quot;maven-resolver&quot; ) } } stage(&#39;Build Docker Image&#39;) { steps { &quot;\n \n \n \n ***************************************&quot; &quot; Build Docker Image&quot; &quot;***************************************\n \n \n&quot; script { docker.build(&quot;satyajohnny.jfrog.io/&quot; + &quot;docker-employeeservices:2.0.${env.BUILD_NUMBER}&quot;) dockerImage = docker.build registry + &quot;:$BUILD_NUMBER&quot; } } } stage(&#39;Push Image to DockerHub&#39;) { steps { script { &quot;\n \n \n \n ***************************************&quot; &quot; Push Image to DockerHub&quot; &quot;*********************************\n \n \n&quot; docker.withRegistry(&#39;&#39;, registryCredential) { dockerImage.push() } } } } } //Stages End } //Pipeline End 5.Docker Image Push to Azure Container Registry To Quick start Azure Container Registry follow https://docs.microsoft.com/en-us/azure/container-registry/container-registry-get-started-portal Select Create a resource &gt; Containers &gt; Container Registry. Go to Access Keys in Container Registry and enable the admin user, then use the autogenerated credentials to login via Docker Configure these credentials in Jenkins with name &#39;azurecontainer-creds&#39; pipeline { environment { dockerregistry = &quot;smlcodes/docker-employeeservices&quot; dockercreds = &#39;docker-creds&#39; dockerHubImage = &#39;&#39; //Go to Access Keys in Container Registry and enable the admin user, then use the autogenerated credentials to login via Docker azureregistry = &quot;satyajohnnycontainer.azurecr.io&quot; azurecreds = &#39;azurecontainer-creds&#39; azureImage = &#39;&#39; } agent tools { &#39;Java8&#39; &#39;Maven&#39; } stages { stage(&#39;Clone&#39;) { steps { git branch: &#39;main&#39;, credentialsId: &#39;github-creds&#39;, url: &#39;https://github.com/smlcodes/docker-springboot-employeeservices.git&#39; } } stage(&#39;Artifactory Configuration&#39;) { steps { rtServer( : &#39;Artifactory-1&#39;, url: &quot;https://satyajohnny.jfrog.io/artifactory&quot;, credentialsId: &quot;jfrog-creds&quot; ) rtMavenResolver( : &#39;maven-resolver&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release&#39;, snapshotRepo: &#39;libs-release-libs-snapshot&#39; ) rtMavenDeployer( : &#39;maven-deployer&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release-local&#39;, snapshotRepo: &#39;libs-release-libs-snapshot-local&#39;, threads: 6 ) } } stage(&#39;Build Maven Project&#39;) { steps { rtMavenRun( tool: &#39;Maven&#39;, pom: &#39;pom.xml&#39;, goals: &#39;-U clean install&#39;, deployerId: &quot;maven-deployer&quot;, resolverId: &quot;maven-resolver&quot; ) } } stage(&#39;Build Docker Image&#39;) { steps { script { azureImage = docker.build(&quot;satyajohnnycontainer.azurecr.io/&quot; + &quot;docker-employeeservices:2.0.${env.BUILD_NUMBER}&quot;) } } } stage(&#39;Push Image to Azure Container Registry&#39;) { steps { script { docker.withRegistry(&#39;https://satyajohnnycontainer.azurecr.io&#39;, azurecreds) { azureImage.push() } } } } stage (&#39;Publish Build Info&#39;) { steps { rtPublishBuildInfo ( serverId: &quot;Artifactory-1&quot; ) } } } //Stages End } //Pipeline End Now go to Azure Container Registry &gt; Services &gt; Repository , see Docker Image published #Login az acr login --name satyajohnnycontainer #List images in registry az acr repository list --name satyajohnnycontainer --output table 6.AKS – Azure Kubernetes Service AKS is a managed Kubernetes service that lets you quickly deploy and manage clusters. We will see how to create AKS cluster in Azure cloud using Azure CLI. Pre-requisites: Azure CLI is installed on your local machine. Account setup in Azure. Create Azure Container Registry #Login to Azure az login #Create a resource group first. az group create --name myResourceGroup --location eastus Run the below command to create your own private container registry using Azure Container Registry az acr create --resource-group myResourceGroup --name satyajohnnycontainer --sku Standard --location eastus Create AKS cluster with 2 worker nodes az aks create --resource-group myResourceGroup --name --node-count 2 --enable-addons monitoring --generate-ssh-keys C:\Windows\system32&gt; --resource-group myResourceGroup --name --node-count 2 --enable-addons monitoring --generate-ssh-keys SSH key files &#39;C:\Users\kavetis\.ssh\id_rsa&#39; and &#39;C:\Users\kavetis\.ssh\id_rsa.pub&#39; have been generated under ~/.ssh to allow SSH access to the VM. If using machines without permanent storage like Azure Cloud Shell without an attached file share, back up your keys to a safe location Resource provider &#39;Microsoft.OperationalInsights&#39; used by this operation is not registered. We are registering for you. Once Above cmd run completes, we can see many no. of services are created which are required by AKS. We can see 2 Nodes inside AKS Cluster Connect to the cluster az aks get-credentials --resource-group myResourceGroup --name --overwrite-existing To verify the connection to your cluster, use the kubectl get command to return a list of the cluster nodes. kubectl get nodes # List all deployments in a specific namespace kubectl get deployments --all-namespaces=true Update Jenkins Pipeline pipeline { agent environment { registry = &quot;smlcodes/docker-employeeservices&quot; registryCredential = &#39;docker-creds&#39; dockerImage = &#39;&#39; } stages { stage(&#39;checkout&#39;) { steps { git branch: &#39;main&#39;, credentialsId: &#39;github-creds&#39;, url: &#39;https://github.com/smlcodes/docker-springboot-employeeservices.git&#39; } } stage(&#39;Artifactory Configuration&#39;) { steps { rtServer( : &#39;Artifactory-1&#39;, url: &quot;https://satyajohnny.jfrog.io/artifactory&quot;, credentialsId: &quot;jfrog-creds&quot; ) rtMavenResolver( : &#39;maven-resolver&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release&#39;, snapshotRepo: &#39;libs-release-libs-snapshot&#39; ) rtMavenDeployer( : &#39;maven-deployer&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release-local&#39;, snapshotRepo: &#39;libs-release-libs-snapshot-local&#39;, threads: 6 ) } } stage(&#39;Build Maven Project&#39;) { steps { rtMavenRun( tool: &#39;Maven&#39;, pom: &#39;pom.xml&#39;, goals: &#39;-U clean install&#39;, deployerId: &quot;maven-deployer&quot;, resolverId: &quot;maven-resolver&quot; ) } } stage(&#39;Build Docker image&#39;) { steps { script { dockerImage = docker.build registry + &quot;:$BUILD_NUMBER&quot; } } } // Uploading Docker images into Docker Hub stage(&#39;Upload Image to Docker HUB&#39;) { steps { script { docker.withRegistry(&#39;&#39;, registryCredential) { dockerImage.push() dockerImage.push(&#39;latest&#39;) } } } } stage(&#39;Remove Unused docker image&#39;) { steps { &quot;docker rmi $registry:$BUILD_NUMBER&quot; } } stage(&#39;K8S Deploy&#39;) { steps { script { kubernetesDeploy( configs: &#39;Kubernetes.yaml&#39;, kubeconfigId: &#39;aks-creds&#39;, enableConfigSubstitution: true ) } } } } } always { // remove built docker image and prune system print &#39;Cleaning up the Docker system.&#39; &#39;docker system prune -f&#39; } Kubernetes.yaml – For Docker HUB apiVersion: apps/v1 kind: Deployment metadata: name: docker-employeeservices-manual spec: replicas: 2 selector: matchLabels: app: docker-employeeservices-manual template: metadata: labels: app: docker-employeeservices-manual spec: containers: - name: docker-employeeservices-manual image: smlcodes/docker-employeeservices # image: wingtiptoysregistry.azurecr.io/gs-spring-boot-docker:latest --- apiVersion: v1 kind: Service metadata: name: docker-employeeservices-manual-service spec: type: LoadBalancer ports: - port: 80 targetPort: 8080 selector: app: docker-employeeservices-manual Build Pipeline Build Is Success, But if you see AKS Cluster it is unable to Pull the Image Here we can see that AKS is not able to pull image from ACR. Let’s describe the pod and look for more information. kubectl get pods docker-employeeservices-acs-86b4879d-7h5x5 0/1 ImagePullBackOff 0 16h docker-employeeservices-acs-86b4879d-b4zc2 0/1 ImagePullBackOff 0 16h kubectl describe pods docker-employeeservices-acs-86b4879d-7h5x5 Here the Problem is ACS &amp; AKS Integration. For that we need to run below command az aks update -n myAKSCluster -g myResourceGroup --attach-acr &lt;acr-name&gt; az aks update -n satyajohnnyAKSCluster -g myResourceGroup --attach-acr satyajohnnycontainer When we attach ACR to AKS, it actually grants the ‘acrpull’ role assignment to ACR specified by name or resource ID. Check Integration Status az aks check-acr --name satyajohnnyAKSCluster --resource-group myResourceGroup \--acr satyajohnnycontainer.azurecr.io Re-Run Pipeline Again. 7. Verify deployments to K8S kubectl get pods kubectl get deployments kubectl get services Here External-IP is the Public IP Where we can access Our Application. You can also get from UI, Go to AKS Portal in below Image Check Pods are Running open public IP without port 8. Final Working Pipeline Code // Dockerfile # Image based on JAVA Container FROM openjdk:8-jdk-alpine ARG JAR_FILE=target/*.jar COPY ${JAR_FILE} Docker-EmployeeServices-2.0.jar EXPOSE 8080 ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/Docker-EmployeeServices-2.0.jar&quot;] // Jenkinsfile pipeline { environment { dockerregistry = &quot;smlcodes/docker-employeeservices&quot; dockercreds = &#39;docker-creds&#39; dockerHubImage = &#39;&#39; //Go to Access Keys in Container Registry and enable the admin user, then use the autogenerated credentials to login via Docker azureregistry = &quot;satyajohnnycontainer.azurecr.io&quot; azurecreds = &#39;azurecontainer-creds&#39; azureImage = &#39;&#39; } agent tools { //Java, Maven Configured in Globol tools configuration. and here the names we provided for configuration &#39;Java8&#39; &#39;Maven&#39; } stages { stage(&#39;Clone&#39;) { steps { //github-creds are github login creds, configured in Credencial Manager git branch: &#39;main&#39;, credentialsId: &#39;github-creds&#39;, url: &#39;https://github.com/smlcodes/docker-springboot-employeeservices.git&#39; } } /* Artifactory-1 - similarly like Globol tool configuration. But we are configured manually, passed as ServerID rtMavenResolver - To get Jars of Pom.xml rtMavenDeployer - To Deploy Newly created jars on Build */ stage(&#39;Artifactory Configuration&#39;) { steps { rtServer( : &#39;Artifactory-1&#39;, url: &quot;https://satyajohnny.jfrog.io/artifactory&quot;, credentialsId: &quot;jfrog-creds&quot; ) rtMavenResolver( : &#39;maven-resolver&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release&#39;, snapshotRepo: &#39;libs-release-libs-snapshot&#39; ) rtMavenDeployer( : &#39;maven-deployer&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release-local&#39;, snapshotRepo: &#39;libs-release-libs-snapshot-local&#39;, threads: 6 ) } } stage(&#39;Build Maven Project&#39;) { steps { rtMavenRun( tool: &#39;Maven&#39;, pom: &#39;pom.xml&#39;, goals: &#39;-U clean install&#39;, deployerId: &quot;maven-deployer&quot;, resolverId: &quot;maven-resolver&quot; ) } } stage(&#39;Build Docker Image&#39;) { steps { &quot;\n \n \n \n ******************************************************************************&quot; &quot; Build Docker Image&quot; &quot;******************************************************************************\n \n \n&quot; script { //docker.build(&quot;satyajohnny.jfrog.io/&quot; + &quot;docker-employeeservices:2.0.${env.BUILD_NUMBER}&quot;) dockerHubImage = docker.build dockerregistry + &quot;:$BUILD_NUMBER&quot; azureImage = docker.build(&quot;satyajohnnycontainer.azurecr.io/&quot; + &quot;docker-employeeservices:${env.BUILD_NUMBER}&quot;) } } } stage(&#39;Push Image to Azure Container Registry&#39;) { steps { script { &quot;\n \n \n \n ******************************************************************************&quot; &quot; Push Image to Azure Container Registry&quot; &quot;******************************************************************************\n \n \n&quot; docker.withRegistry(&#39;https://satyajohnnycontainer.azurecr.io&#39;, azurecreds) { azureImage.push() azureImage.push(&#39;latest&#39;) } } } } // Uploading Docker images into Docker Hub stage(&#39;Push Image to Docker HUB&#39;) { steps { script { docker.withRegistry(&#39;&#39;, dockercreds) { dockerHubImage.push() dockerHubImage.push(&#39;latest&#39;) } } } } stage(&#39;Remove Unused docker image&#39;) { steps { &quot;docker rmi $dockerregistry:$BUILD_NUMBER&quot; } } // Deploy To Azure Kubernetes Cluster stage(&#39;K8S Deploy&#39;) { steps { script { kubernetesDeploy( configs: &#39;Kubernetes.yaml&#39;, kubeconfigId: &#39;aks-creds&#39;, enableConfigSubstitution: true ) } } } /* Push Image to Artfifactory Not Woking serverId : Configred Artfifactory Server Name host : docker daemon host where Docker currenlty running system/localhost targetRepo : Repo name in Artfifactory */ /* stage (&#39;Push Image to Artifactory&#39;) { steps { echo &quot;\n \n \n \n ******************************************************************************&quot; echo &quot; Not Working on LocalHost : Push Docker Image to Artifactory&quot; echo &quot;******************************************************************************\n \n \n&quot; rtDockerPush( serverId: &quot;Artifactory-1&quot;, image: &quot;satyajohnny.jfrog.io/&quot; + &quot;docker-employeeservices:2.0.${env.BUILD_NUMBER}&quot;, host: &#39;tcp://thedockerhost:2375/&#39;, targetRepo: &#39;jenkins-docker-images&#39;, properties: &#39;project-name=docker-employeeservices:2.0;status=stable&#39; ) } } */ /* stage(&#39;Push Image to DockerHub&#39;) { steps { script { echo &quot;\n \n \n \n ******************************************************************************&quot; echo &quot; Working - Push Image to DockerHub&quot; echo &quot;******************************************************************************\n \n \n&quot; docker.withRegistry(&#39;&#39;, dockercreds) { dockerHubImage.push() } } } } */ } //Stages End } //Pipeline End always { // remove built docker image and prune system print &#39;Cleaning up the Docker system.&#39; &#39;docker system prune -f&#39; } Kubernetes.yaml apiVersion: apps/v1 kind: Deployment metadata: name: docker-employeeservices-acs spec: replicas: 2 selector: matchLabels: app: docker-employeeservices-acs template: metadata: labels: app: docker-employeeservices-acs spec: containers: - name: docker-employeeservices-acs image: satyajohnnycontainer.azurecr.io/docker-employeeservices:latest #image: smlcodes/docker-employeeservices --- apiVersion: v1 kind: Service metadata: name: docker-employeeservices-acs-service spec: type: LoadBalancer ports: - port: 80 targetPort: 8080 selector: app: docker-employeeservices-acs 9. Delete Cluster To avoid Azure charges, you should clean up unneeded resources. When the cluster is no longer needed, use the az group delete command to remove the resource group, container service, and all related resources. az group delete --name myResourceGroup --yes --no-wait Ref. https://www.coachdevops.com/2020/06/deploy-python-app-into-kubernetes.html https://docs.microsoft.com/en-us/azure/mysql/quickstart-create-mysql-server-database-using-azure-portal https://reflectoring.io/spring-boot-docker/ https://medium.com/swlh/build-a-docker-image-using-maven-and-spring-boot-58147045a400 https://medium.com/@gustavo.guss/jenkins-building-docker-image-and-sending-to-registry-64b84ea45ee9 https://docs.microsoft.com/en-us/azure/container-registry/container-registry-get-started-portal https://jfrog.com/blog/ci-cd-side-by-side-jenkins-and-jfrog-pipelines/ https://www.jfrog.com/confluence/display/JFROG/Declarative+Pipeline+Syntax https://technology.amis.nl/languages/java-languages/jenkins-building-java-and-deploying-to-kubernetes/ https://github.com/talitz/spring-petclinic-ci-cd-k8s-example/blob/master/Jenkinsfile https://dzone.com/articles/building-docker-images-to-docker-hub-using-jenkins https://stackoverflow.com/questions/58203820/jenkins-with-jfrog-artifactory-push-docker-images https://stackoverflow.com/questions/50022357/can-not-push-docker-image-to-artifactory-in-jenkins-pipeline-using-artifactory-p https://github.com/dumindarw/reactive-eventservice/blob/master/Jenkinsfile https://github.com/learnk8s/free-kubernetes https://docs.microsoft.com/en-us/azure/architecture/solution-ideas/articles/container-cicd-using-jenkins-and-kubernetes-on-azure-container-service https://ystatit.medium.com/azure-configure-acr-integration-for-existing-aks-cluster-c551c678fede https://github.com/dumindarw/reactive-eventservice/blob/master/Jenkinsfile https://github.com/learnk8s/free-kubernetes https://docs.microsoft.com/en-us/azure/architecture/solution-ideas/articles/container-cicd-using-jenkins-and-kubernetes-on-azure-container-service" />
<meta property="og:site_name" content="SatyaCodes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-08-11T08:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Jenkins – Jenkins Pipeline for SpringBoot Application JFrog + Docker + Kubernetes + Azure ACS &amp; AKS" />
<script type="application/ld+json">
{"datePublished":"2021-08-11T08:00:00+00:00","dateModified":"2021-08-11T08:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"/Jenkins-Pipeline-for-SpringBoot-Application-JFrog-Docker-Kubernetes-Azure-ACS-AKS.html"},"author":{"@type":"Person","name":"Satya Kaveti"},"@type":"BlogPosting","description":"Jenkins – Jenkins Pipeline for SpringBoot Application JFrog + Docker + Kubernetes + Azure ACS &amp; AKS 1.Configure SpringBoot Project We have SpringBoot application in Github. https://github.com/smlcodes/Docker-SpringBoot-EmployeeServices.git we have removed MySQL dependency from docker because we do not require separate MySQL instance for each Image. Build &amp; Run the GitHub code. 2.Create MySQL Database in Azure https://docs.microsoft.com/en-us/azure/mysql/quickstart-create-mysql-server-database-using-azure-portal 3.Manual Docker Image for SpringBoot Project To containerize an application, we enclose our application inside a container image and publish that image to a shared registry. The container runtime pulls this image from the registry, unpacks the image, and runs the application inside it. a. Building a Container Image the Conventional Way 1.Creating a Dockerfile A Dockerfile is a plain text file that contains instructions from which a Docker image is built. Create a Dockerfile in the project’s root folder. A Dockerfile contains the commands below. FROM: directive sets the image on which the container will be based on. RUN: executes commands in the container. COPY: creates a copy of files from the file system in the container. CMD: sets the executable commands within the container. # Image based on JAVA Container FROM openjdk:8-jdk-alpine ARG JAR_FILE=target/*.jar COPY ${JAR_FILE} Docker-EmployeeServices-1.0.jar EXPOSE 8080 ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/Docker-EmployeeServices-1.0.jar&quot;] 2.Building the Application We first build the application with Maven. This creates an executable JAR of the application. We need to convert this executable JAR into a Docker image for running in a Docker engine. mvn clean package 3. Building the Container Image We need to create Docker image from jar file by running docker build -t Repository:TAGVERSION docker build -t employeeservices:latest . We can see our image listed with the command: docker images 4.Viewing the Layers Inside the Container Image We will use the dive tool to view check layers inside the image. using dive Repository:TAGVERSION 5.Running Docker Image docker run --name employeeservices -d -p 8080:8080 employeeservices:latest 6.Execute the command below to list all the running Docker containers. docker container ps 7.Access Running application by docker URL b. Building Using Maven By using Maven, we have multiple options. Using the integrated Spring Boot build-image goal. Using the jib-maven-plugin from Google. Using the dockerfile-maven-plugin from Spotify. 1.Using the integrated Spring Boot build-image goal. Spring Boot comes pre-shipped with its own plugin for building Docker images and you don’t need to make any changes. It is available through the standard spring-boot-starter-parent that is included in your pom.xml. you do not need to write a Dockerfile either and the plugin takes care of Spring-recommended security, memory, and performance optimizations. if there is a Dockerfile located within your source code repository, it will be ignored. To create Docker image, just run mvn spring-boot:build-image make sure project name must be on small letters &amp; no special symbols 2. Using the jib-maven-plugin from Google Jib is a Maven and Gradle plugin for creating Docker images for Java applications. it does not require Docker to be installed locally it does not require you to have written a Dockerfile Best Choice for Continuous Integration / build server jib-maven-plugin will build and push the image straight to the Docker registry of choice. **Using Local System** Since we are not pushing to a Docker registry, we will tell Jib to use our local Docker installation by using the dockerBuild goal. pom.xml &lt;plugin&gt; &lt;groupId&gt;com.google.cloud.tools&lt;/groupId&gt; &lt;artifactId&gt;jib-maven-plugin&lt;/artifactId&gt; &lt;version&gt;2.6.0&lt;/version&gt; &lt;configuration&gt; &lt;from&gt; &lt;image&gt;gcr.io/distroless/java:8&lt;/image&gt; &lt;/from&gt; &lt;to&gt; &lt;image&gt;docker-employeeservices:${project.version}&lt;/image&gt; &lt;/to&gt; &lt;/configuration&gt; &lt;/plugin&gt; # Builds to a container image and pushes registry. $ mvn compile jib:build # Builds to a Docker daemon in local system. $ mvn compile jib:dockerBuild # This builds and saves your image as tarball to target/jib-image.tar $ mvn compile jib:buildTar # you can load tar Image into docker with docker load --input target/jib-image.tar $ The only configuration we needed is to provide was &lt;to&gt;&lt;image&gt;, which is the name of our Docker image. We can now use that plugin to create a Docker image that will be available on our local Docker daemon. To build the Docker image, run the command, without maven dependency in pom.xml mvn compile com.google.cloud.tools:jib-maven-plugin:2.3.0:dockerBuild **Using DockerHub** 1.add registry credentials to the Maven Maven\\conf\\settings.xml file &lt;server&gt; &lt;id&gt;registry.hub.docker.com&lt;/id&gt; &lt;username&gt;smlcodes&lt;/username&gt; &lt;password&gt;passw0rd@&lt;/password&gt; &lt;/server&gt; 2.Update pom.xml &lt;plugin&gt; &lt;groupId&gt;com.google.cloud.tools&lt;/groupId&gt; &lt;artifactId&gt;jib-maven-plugin&lt;/artifactId&gt; &lt;version&gt;2.6.0&lt;/version&gt; &lt;configuration&gt; &lt;from&gt; &lt;image&gt;gcr.io/distroless/java:8&lt;/image&gt; &lt;/from&gt; &lt;to&gt; &lt;image&gt;smlcodes/docker-employeeservices:${project.version}&lt;/image&gt; &lt;/to&gt; &lt;/configuration&gt; &lt;/plugin&gt; Typically, you don’t need to provide &lt;from&gt; as by default, as it uses a distro-less Java 8 image. However, I have used Java 11, so I have explicitly mentioned that here. Moreover, depending on your use case, you may want to use a different base image &lt;image&gt; This refers to the target image that will pushed to the container registry. To Build &amp; Publish docker image mvn compile jib:build Check Docker HUB online I have used a Docker registry, but you can use any cloud provider’s (ECS, GCR, ACR) container registry. For other options available for use with the plugin, you can refer to the documentation. 3.Using the dockerfile-maven-plugin Add your Dockerfile into your root directory alongside your pom.xml. &lt;plugin&gt; &lt;groupId&gt;com.spotify&lt;/groupId&gt; &lt;artifactId&gt;dockerfile-maven-plugin&lt;/artifactId&gt; &lt;version&gt;1.4.13&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;default&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;build&lt;/goal&gt; &lt;goal&gt;push&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;configuration&gt; &lt;repository&gt;${project.artifactId}&lt;/repository&gt; &lt;tag&gt;${project.version}&lt;/tag&gt; &lt;buildArgs&gt; &lt;JAR_FILE&gt;target/${project.build.finalName}.jar&lt;/JAR_FILE&gt; &lt;/buildArgs&gt; &lt;/configuration&gt; &lt;/plugin&gt; 4.Jenkins Configuration Downoad &amp; Start Jenkins from here cd C:\\Docker\\Jenkins java -jar jenkins.war --httpPort=2222 echo &quot;Jenkins Started . . . &quot; Login to Jenkins http://localhost:2222/ admin/admin 5.Docker Image PUSH to JFrog Artifactory Go to JFrog Website: https://jfrog.com/start-free create an account, login On your system cmdline docker login satyajohnny.jfrog.io From next time onwards it won’t ask for Credentials Go to Administration &gt; Add Repository &gt; Local &gt; Select : Docker &gt; Name : jenkins-docker-images To Integrate with Jenkins, follow http://satyacodes.ml/jenkins/jfrog-integration pipeline { agent tools { //Java, Maven Configured in Globol tools configuration. and here the names we provided for configuration &#39;Java8&#39; &#39;Maven&#39; } stages { stage (&#39;Clone&#39;) { steps { //github-creds are github login creds, configured in Credencial Manager git branch: &#39;main&#39;, credentialsId: &#39;github-creds&#39;, url: &#39;https://github.com/smlcodes/Docker-SpringBoot-EmployeeServices.git&#39; } } /* Artifactory-1 - similarly like Globol tool configuration. But we are configured manually, passed as ServerID rtMavenResolver - To get Jars of Pom.xml rtMavenDeployer - To Deploy Newly created jars on Build */ stage (&#39;Artifactory Configuration&#39;) { steps { rtServer ( : &#39;Artifactory-1&#39;, url: &quot;https://satyajohnny.jfrog.io/artifactory&quot;, credentialsId: &quot;jfrog-creds&quot; ) rtMavenResolver ( : &#39;maven-resolver&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release&#39;, snapshotRepo: &#39;libs-release-libs-snapshot&#39; ) rtMavenDeployer ( : &#39;maven-deployer&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release-local&#39;, snapshotRepo: &#39;libs-release-libs-snapshot-local&#39;, threads: 6 ) } } stage(&#39;Build Maven Project&#39;) { steps { rtMavenRun ( tool: &#39;Maven&#39;, pom: &#39;pom.xml&#39;, goals: &#39;-X clean install&#39;, deployerId: &quot;maven-deployer&quot;, resolverId: &quot;maven-resolver&quot; ) } } } } After Running this New jars added to JFrog Artifactory 5.Docker Image Push to Docker HUB First, create a environment to save docker image information’s. dockerImage = &#39;&#39; Change the build stage to save build information in environment. dockerImage = docker.build registry + &quot;:$BUILD_NUMBER&quot; pipeline { environment { registry = &quot;smlcodes/docker-employeeservices&quot; registryCredential = &#39;docker-creds&#39; dockerImage = &#39;&#39; } agent tools { &#39;Java8&#39; &#39;Maven&#39; } stages { stage(&#39;Clone&#39;) { steps { git branch: &#39;main&#39;, credentialsId: &#39;github-creds&#39;, url: &#39;https://github.com/smlcodes/docker-springboot-employeeservices.git&#39; } } /* Artifactory-1 - similarly like Globol tool configuration. But we are configured manually, passed as ServerID rtMavenResolver - To get Jars of Pom.xml rtMavenDeployer - To Deploy Newly created jars on Build */ stage(&#39;Artifactory Configuration&#39;) { steps { rtServer( : &#39;Artifactory-1&#39;, url: &quot;https://satyajohnny.jfrog.io/artifactory&quot;, credentialsId: &quot;jfrog-creds&quot; ) rtMavenResolver( : &#39;maven-resolver&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release&#39;, snapshotRepo: &#39;libs-release-libs-snapshot&#39; ) rtMavenDeployer( : &#39;maven-deployer&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release-local&#39;, snapshotRepo: &#39;libs-release-libs-snapshot-local&#39;, threads: 6 ) } } stage(&#39;Build Maven Project&#39;) { steps { rtMavenRun( tool: &#39;Maven&#39;, pom: &#39;pom.xml&#39;, goals: &#39;-U clean install&#39;, deployerId: &quot;maven-deployer&quot;, resolverId: &quot;maven-resolver&quot; ) } } stage(&#39;Build Docker Image&#39;) { steps { &quot;\\n \\n \\n \\n ***************************************&quot; &quot; Build Docker Image&quot; &quot;***************************************\\n \\n \\n&quot; script { docker.build(&quot;satyajohnny.jfrog.io/&quot; + &quot;docker-employeeservices:2.0.${env.BUILD_NUMBER}&quot;) dockerImage = docker.build registry + &quot;:$BUILD_NUMBER&quot; } } } stage(&#39;Push Image to DockerHub&#39;) { steps { script { &quot;\\n \\n \\n \\n ***************************************&quot; &quot; Push Image to DockerHub&quot; &quot;*********************************\\n \\n \\n&quot; docker.withRegistry(&#39;&#39;, registryCredential) { dockerImage.push() } } } } } //Stages End } //Pipeline End 5.Docker Image Push to Azure Container Registry To Quick start Azure Container Registry follow https://docs.microsoft.com/en-us/azure/container-registry/container-registry-get-started-portal Select Create a resource &gt; Containers &gt; Container Registry. Go to Access Keys in Container Registry and enable the admin user, then use the autogenerated credentials to login via Docker Configure these credentials in Jenkins with name &#39;azurecontainer-creds&#39; pipeline { environment { dockerregistry = &quot;smlcodes/docker-employeeservices&quot; dockercreds = &#39;docker-creds&#39; dockerHubImage = &#39;&#39; //Go to Access Keys in Container Registry and enable the admin user, then use the autogenerated credentials to login via Docker azureregistry = &quot;satyajohnnycontainer.azurecr.io&quot; azurecreds = &#39;azurecontainer-creds&#39; azureImage = &#39;&#39; } agent tools { &#39;Java8&#39; &#39;Maven&#39; } stages { stage(&#39;Clone&#39;) { steps { git branch: &#39;main&#39;, credentialsId: &#39;github-creds&#39;, url: &#39;https://github.com/smlcodes/docker-springboot-employeeservices.git&#39; } } stage(&#39;Artifactory Configuration&#39;) { steps { rtServer( : &#39;Artifactory-1&#39;, url: &quot;https://satyajohnny.jfrog.io/artifactory&quot;, credentialsId: &quot;jfrog-creds&quot; ) rtMavenResolver( : &#39;maven-resolver&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release&#39;, snapshotRepo: &#39;libs-release-libs-snapshot&#39; ) rtMavenDeployer( : &#39;maven-deployer&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release-local&#39;, snapshotRepo: &#39;libs-release-libs-snapshot-local&#39;, threads: 6 ) } } stage(&#39;Build Maven Project&#39;) { steps { rtMavenRun( tool: &#39;Maven&#39;, pom: &#39;pom.xml&#39;, goals: &#39;-U clean install&#39;, deployerId: &quot;maven-deployer&quot;, resolverId: &quot;maven-resolver&quot; ) } } stage(&#39;Build Docker Image&#39;) { steps { script { azureImage = docker.build(&quot;satyajohnnycontainer.azurecr.io/&quot; + &quot;docker-employeeservices:2.0.${env.BUILD_NUMBER}&quot;) } } } stage(&#39;Push Image to Azure Container Registry&#39;) { steps { script { docker.withRegistry(&#39;https://satyajohnnycontainer.azurecr.io&#39;, azurecreds) { azureImage.push() } } } } stage (&#39;Publish Build Info&#39;) { steps { rtPublishBuildInfo ( serverId: &quot;Artifactory-1&quot; ) } } } //Stages End } //Pipeline End Now go to Azure Container Registry &gt; Services &gt; Repository , see Docker Image published #Login az acr login --name satyajohnnycontainer #List images in registry az acr repository list --name satyajohnnycontainer --output table 6.AKS – Azure Kubernetes Service AKS is a managed Kubernetes service that lets you quickly deploy and manage clusters. We will see how to create AKS cluster in Azure cloud using Azure CLI. Pre-requisites: Azure CLI is installed on your local machine. Account setup in Azure. Create Azure Container Registry #Login to Azure az login #Create a resource group first. az group create --name myResourceGroup --location eastus Run the below command to create your own private container registry using Azure Container Registry az acr create --resource-group myResourceGroup --name satyajohnnycontainer --sku Standard --location eastus Create AKS cluster with 2 worker nodes az aks create --resource-group myResourceGroup --name --node-count 2 --enable-addons monitoring --generate-ssh-keys C:\\Windows\\system32&gt; --resource-group myResourceGroup --name --node-count 2 --enable-addons monitoring --generate-ssh-keys SSH key files &#39;C:\\Users\\kavetis\\.ssh\\id_rsa&#39; and &#39;C:\\Users\\kavetis\\.ssh\\id_rsa.pub&#39; have been generated under ~/.ssh to allow SSH access to the VM. If using machines without permanent storage like Azure Cloud Shell without an attached file share, back up your keys to a safe location Resource provider &#39;Microsoft.OperationalInsights&#39; used by this operation is not registered. We are registering for you. Once Above cmd run completes, we can see many no. of services are created which are required by AKS. We can see 2 Nodes inside AKS Cluster Connect to the cluster az aks get-credentials --resource-group myResourceGroup --name --overwrite-existing To verify the connection to your cluster, use the kubectl get command to return a list of the cluster nodes. kubectl get nodes # List all deployments in a specific namespace kubectl get deployments --all-namespaces=true Update Jenkins Pipeline pipeline { agent environment { registry = &quot;smlcodes/docker-employeeservices&quot; registryCredential = &#39;docker-creds&#39; dockerImage = &#39;&#39; } stages { stage(&#39;checkout&#39;) { steps { git branch: &#39;main&#39;, credentialsId: &#39;github-creds&#39;, url: &#39;https://github.com/smlcodes/docker-springboot-employeeservices.git&#39; } } stage(&#39;Artifactory Configuration&#39;) { steps { rtServer( : &#39;Artifactory-1&#39;, url: &quot;https://satyajohnny.jfrog.io/artifactory&quot;, credentialsId: &quot;jfrog-creds&quot; ) rtMavenResolver( : &#39;maven-resolver&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release&#39;, snapshotRepo: &#39;libs-release-libs-snapshot&#39; ) rtMavenDeployer( : &#39;maven-deployer&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release-local&#39;, snapshotRepo: &#39;libs-release-libs-snapshot-local&#39;, threads: 6 ) } } stage(&#39;Build Maven Project&#39;) { steps { rtMavenRun( tool: &#39;Maven&#39;, pom: &#39;pom.xml&#39;, goals: &#39;-U clean install&#39;, deployerId: &quot;maven-deployer&quot;, resolverId: &quot;maven-resolver&quot; ) } } stage(&#39;Build Docker image&#39;) { steps { script { dockerImage = docker.build registry + &quot;:$BUILD_NUMBER&quot; } } } // Uploading Docker images into Docker Hub stage(&#39;Upload Image to Docker HUB&#39;) { steps { script { docker.withRegistry(&#39;&#39;, registryCredential) { dockerImage.push() dockerImage.push(&#39;latest&#39;) } } } } stage(&#39;Remove Unused docker image&#39;) { steps { &quot;docker rmi $registry:$BUILD_NUMBER&quot; } } stage(&#39;K8S Deploy&#39;) { steps { script { kubernetesDeploy( configs: &#39;Kubernetes.yaml&#39;, kubeconfigId: &#39;aks-creds&#39;, enableConfigSubstitution: true ) } } } } } always { // remove built docker image and prune system print &#39;Cleaning up the Docker system.&#39; &#39;docker system prune -f&#39; } Kubernetes.yaml – For Docker HUB apiVersion: apps/v1 kind: Deployment metadata: name: docker-employeeservices-manual spec: replicas: 2 selector: matchLabels: app: docker-employeeservices-manual template: metadata: labels: app: docker-employeeservices-manual spec: containers: - name: docker-employeeservices-manual image: smlcodes/docker-employeeservices # image: wingtiptoysregistry.azurecr.io/gs-spring-boot-docker:latest --- apiVersion: v1 kind: Service metadata: name: docker-employeeservices-manual-service spec: type: LoadBalancer ports: - port: 80 targetPort: 8080 selector: app: docker-employeeservices-manual Build Pipeline Build Is Success, But if you see AKS Cluster it is unable to Pull the Image Here we can see that AKS is not able to pull image from ACR. Let’s describe the pod and look for more information. kubectl get pods docker-employeeservices-acs-86b4879d-7h5x5 0/1 ImagePullBackOff 0 16h docker-employeeservices-acs-86b4879d-b4zc2 0/1 ImagePullBackOff 0 16h kubectl describe pods docker-employeeservices-acs-86b4879d-7h5x5 Here the Problem is ACS &amp; AKS Integration. For that we need to run below command az aks update -n myAKSCluster -g myResourceGroup --attach-acr &lt;acr-name&gt; az aks update -n satyajohnnyAKSCluster -g myResourceGroup --attach-acr satyajohnnycontainer When we attach ACR to AKS, it actually grants the ‘acrpull’ role assignment to ACR specified by name or resource ID. Check Integration Status az aks check-acr --name satyajohnnyAKSCluster --resource-group myResourceGroup \\--acr satyajohnnycontainer.azurecr.io Re-Run Pipeline Again. 7. Verify deployments to K8S kubectl get pods kubectl get deployments kubectl get services Here External-IP is the Public IP Where we can access Our Application. You can also get from UI, Go to AKS Portal in below Image Check Pods are Running open public IP without port 8. Final Working Pipeline Code // Dockerfile # Image based on JAVA Container FROM openjdk:8-jdk-alpine ARG JAR_FILE=target/*.jar COPY ${JAR_FILE} Docker-EmployeeServices-2.0.jar EXPOSE 8080 ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/Docker-EmployeeServices-2.0.jar&quot;] // Jenkinsfile pipeline { environment { dockerregistry = &quot;smlcodes/docker-employeeservices&quot; dockercreds = &#39;docker-creds&#39; dockerHubImage = &#39;&#39; //Go to Access Keys in Container Registry and enable the admin user, then use the autogenerated credentials to login via Docker azureregistry = &quot;satyajohnnycontainer.azurecr.io&quot; azurecreds = &#39;azurecontainer-creds&#39; azureImage = &#39;&#39; } agent tools { //Java, Maven Configured in Globol tools configuration. and here the names we provided for configuration &#39;Java8&#39; &#39;Maven&#39; } stages { stage(&#39;Clone&#39;) { steps { //github-creds are github login creds, configured in Credencial Manager git branch: &#39;main&#39;, credentialsId: &#39;github-creds&#39;, url: &#39;https://github.com/smlcodes/docker-springboot-employeeservices.git&#39; } } /* Artifactory-1 - similarly like Globol tool configuration. But we are configured manually, passed as ServerID rtMavenResolver - To get Jars of Pom.xml rtMavenDeployer - To Deploy Newly created jars on Build */ stage(&#39;Artifactory Configuration&#39;) { steps { rtServer( : &#39;Artifactory-1&#39;, url: &quot;https://satyajohnny.jfrog.io/artifactory&quot;, credentialsId: &quot;jfrog-creds&quot; ) rtMavenResolver( : &#39;maven-resolver&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release&#39;, snapshotRepo: &#39;libs-release-libs-snapshot&#39; ) rtMavenDeployer( : &#39;maven-deployer&#39;, serverId: &#39;Artifactory-1&#39;, releaseRepo: &#39;libs-release-libs-release-local&#39;, snapshotRepo: &#39;libs-release-libs-snapshot-local&#39;, threads: 6 ) } } stage(&#39;Build Maven Project&#39;) { steps { rtMavenRun( tool: &#39;Maven&#39;, pom: &#39;pom.xml&#39;, goals: &#39;-U clean install&#39;, deployerId: &quot;maven-deployer&quot;, resolverId: &quot;maven-resolver&quot; ) } } stage(&#39;Build Docker Image&#39;) { steps { &quot;\\n \\n \\n \\n ******************************************************************************&quot; &quot; Build Docker Image&quot; &quot;******************************************************************************\\n \\n \\n&quot; script { //docker.build(&quot;satyajohnny.jfrog.io/&quot; + &quot;docker-employeeservices:2.0.${env.BUILD_NUMBER}&quot;) dockerHubImage = docker.build dockerregistry + &quot;:$BUILD_NUMBER&quot; azureImage = docker.build(&quot;satyajohnnycontainer.azurecr.io/&quot; + &quot;docker-employeeservices:${env.BUILD_NUMBER}&quot;) } } } stage(&#39;Push Image to Azure Container Registry&#39;) { steps { script { &quot;\\n \\n \\n \\n ******************************************************************************&quot; &quot; Push Image to Azure Container Registry&quot; &quot;******************************************************************************\\n \\n \\n&quot; docker.withRegistry(&#39;https://satyajohnnycontainer.azurecr.io&#39;, azurecreds) { azureImage.push() azureImage.push(&#39;latest&#39;) } } } } // Uploading Docker images into Docker Hub stage(&#39;Push Image to Docker HUB&#39;) { steps { script { docker.withRegistry(&#39;&#39;, dockercreds) { dockerHubImage.push() dockerHubImage.push(&#39;latest&#39;) } } } } stage(&#39;Remove Unused docker image&#39;) { steps { &quot;docker rmi $dockerregistry:$BUILD_NUMBER&quot; } } // Deploy To Azure Kubernetes Cluster stage(&#39;K8S Deploy&#39;) { steps { script { kubernetesDeploy( configs: &#39;Kubernetes.yaml&#39;, kubeconfigId: &#39;aks-creds&#39;, enableConfigSubstitution: true ) } } } /* Push Image to Artfifactory Not Woking serverId : Configred Artfifactory Server Name host : docker daemon host where Docker currenlty running system/localhost targetRepo : Repo name in Artfifactory */ /* stage (&#39;Push Image to Artifactory&#39;) { steps { echo &quot;\\n \\n \\n \\n ******************************************************************************&quot; echo &quot; Not Working on LocalHost : Push Docker Image to Artifactory&quot; echo &quot;******************************************************************************\\n \\n \\n&quot; rtDockerPush( serverId: &quot;Artifactory-1&quot;, image: &quot;satyajohnny.jfrog.io/&quot; + &quot;docker-employeeservices:2.0.${env.BUILD_NUMBER}&quot;, host: &#39;tcp://thedockerhost:2375/&#39;, targetRepo: &#39;jenkins-docker-images&#39;, properties: &#39;project-name=docker-employeeservices:2.0;status=stable&#39; ) } } */ /* stage(&#39;Push Image to DockerHub&#39;) { steps { script { echo &quot;\\n \\n \\n \\n ******************************************************************************&quot; echo &quot; Working - Push Image to DockerHub&quot; echo &quot;******************************************************************************\\n \\n \\n&quot; docker.withRegistry(&#39;&#39;, dockercreds) { dockerHubImage.push() } } } } */ } //Stages End } //Pipeline End always { // remove built docker image and prune system print &#39;Cleaning up the Docker system.&#39; &#39;docker system prune -f&#39; } Kubernetes.yaml apiVersion: apps/v1 kind: Deployment metadata: name: docker-employeeservices-acs spec: replicas: 2 selector: matchLabels: app: docker-employeeservices-acs template: metadata: labels: app: docker-employeeservices-acs spec: containers: - name: docker-employeeservices-acs image: satyajohnnycontainer.azurecr.io/docker-employeeservices:latest #image: smlcodes/docker-employeeservices --- apiVersion: v1 kind: Service metadata: name: docker-employeeservices-acs-service spec: type: LoadBalancer ports: - port: 80 targetPort: 8080 selector: app: docker-employeeservices-acs 9. Delete Cluster To avoid Azure charges, you should clean up unneeded resources. When the cluster is no longer needed, use the az group delete command to remove the resource group, container service, and all related resources. az group delete --name myResourceGroup --yes --no-wait Ref. https://www.coachdevops.com/2020/06/deploy-python-app-into-kubernetes.html https://docs.microsoft.com/en-us/azure/mysql/quickstart-create-mysql-server-database-using-azure-portal https://reflectoring.io/spring-boot-docker/ https://medium.com/swlh/build-a-docker-image-using-maven-and-spring-boot-58147045a400 https://medium.com/@gustavo.guss/jenkins-building-docker-image-and-sending-to-registry-64b84ea45ee9 https://docs.microsoft.com/en-us/azure/container-registry/container-registry-get-started-portal https://jfrog.com/blog/ci-cd-side-by-side-jenkins-and-jfrog-pipelines/ https://www.jfrog.com/confluence/display/JFROG/Declarative+Pipeline+Syntax https://technology.amis.nl/languages/java-languages/jenkins-building-java-and-deploying-to-kubernetes/ https://github.com/talitz/spring-petclinic-ci-cd-k8s-example/blob/master/Jenkinsfile https://dzone.com/articles/building-docker-images-to-docker-hub-using-jenkins https://stackoverflow.com/questions/58203820/jenkins-with-jfrog-artifactory-push-docker-images https://stackoverflow.com/questions/50022357/can-not-push-docker-image-to-artifactory-in-jenkins-pipeline-using-artifactory-p https://github.com/dumindarw/reactive-eventservice/blob/master/Jenkinsfile https://github.com/learnk8s/free-kubernetes https://docs.microsoft.com/en-us/azure/architecture/solution-ideas/articles/container-cicd-using-jenkins-and-kubernetes-on-azure-container-service https://ystatit.medium.com/azure-configure-acr-integration-for-existing-aks-cluster-c551c678fede https://github.com/dumindarw/reactive-eventservice/blob/master/Jenkinsfile https://github.com/learnk8s/free-kubernetes https://docs.microsoft.com/en-us/azure/architecture/solution-ideas/articles/container-cicd-using-jenkins-and-kubernetes-on-azure-container-service","url":"/Jenkins-Pipeline-for-SpringBoot-Application-JFrog-Docker-Kubernetes-Azure-ACS-AKS.html","headline":"Jenkins – Jenkins Pipeline for SpringBoot Application JFrog + Docker + Kubernetes + Azure ACS &amp; AKS","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<!-- start custom head snippets -->

<!-- end custom head snippets --><script>(function() {
  window.isArray = function(val) {
    return Object.prototype.toString.call(val) === '[object Array]';
  };
  window.isString = function(val) {
    return typeof val === 'string';
  };

  window.hasEvent = function(event) {
    return 'on'.concat(event) in window.document;
  };

  window.isOverallScroller = function(node) {
    return node === document.documentElement || node === document.body || node === window;
  };

  window.isFormElement = function(node) {
    var tagName = node.tagName;
    return tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA';
  };

  window.pageLoad = (function () {
    var loaded = false, cbs = [];
    window.addEventListener('load', function () {
      var i;
      loaded = true;
      if (cbs.length > 0) {
        for (i = 0; i < cbs.length; i++) {
          cbs[i]();
        }
      }
    });
    return {
      then: function(cb) {
        cb && (loaded ? cb() : (cbs.push(cb)));
      }
    };
  })();
})();
(function() {
  window.throttle = function(func, wait) {
    var args, result, thisArg, timeoutId, lastCalled = 0;

    function trailingCall() {
      lastCalled = new Date;
      timeoutId = null;
      result = func.apply(thisArg, args);
    }
    return function() {
      var now = new Date,
        remaining = wait - (now - lastCalled);

      args = arguments;
      thisArg = this;

      if (remaining <= 0) {
        clearTimeout(timeoutId);
        timeoutId = null;
        lastCalled = now;
        result = func.apply(thisArg, args);
      } else if (!timeoutId) {
        timeoutId = setTimeout(trailingCall, remaining);
      }
      return result;
    };
  };
})();
(function() {
  var Set = (function() {
    var add = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (data[i] === item) {
          return;
        }
      }
      this.size ++;
      data.push(item);
      return data;
    };

    var Set = function(data) {
      this.size = 0;
      this._data = [];
      var i;
      if (data.length > 0) {
        for (i = 0; i < data.length; i++) {
          add.call(this, data[i]);
        }
      }
    };
    Set.prototype.add = add;
    Set.prototype.get = function(index) { return this._data[index]; };
    Set.prototype.has = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (this.get(i) === item) {
          return true;
        }
      }
      return false;
    };
    Set.prototype.is = function(map) {
      if (map._data.length !== this._data.length) { return false; }
      var i, j, flag, tData = this._data, mData = map._data;
      for (i = 0; i < tData.length; i++) {
        for (flag = false, j = 0; j < mData.length; j++) {
          if (tData[i] === mData[j]) {
            flag = true;
            break;
          }
        }
        if (!flag) { return false; }
      }
      return true;
    };
    Set.prototype.values = function() {
      return this._data;
    };
    return Set;
  })();

  window.Lazyload = (function(doc) {
    var queue = {js: [], css: []}, sources = {js: {}, css: {}}, context = this;
    var createNode = function(name, attrs) {
      var node = doc.createElement(name), attr;
      for (attr in attrs) {
        if (attrs.hasOwnProperty(attr)) {
          node.setAttribute(attr, attrs[attr]);
        }
      }
      return node;
    };
    var end = function(type, url) {
      var s, q, qi, cbs, i, j, cur, val, flag;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        s[url] = true;
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (cur.urls.has(url)) {
            qi = cur, val = qi.urls.values();
            qi && (cbs = qi.callbacks);
            for (flag = true, j = 0; j < val.length; j++) {
              cur = val[j];
              if (!s[cur]) {
                flag = false;
              }
            }
            if (flag && cbs && cbs.length > 0) {
              for (j = 0; j < cbs.length; j++) {
                cbs[j].call(context);
              }
              qi.load = true;
            }
          }
        }
      }
    };
    var load = function(type, urls, callback) {
      var s, q, qi, node, i, cur,
        _urls = typeof urls === 'string' ? new Set([urls]) : new Set(urls), val, url;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (_urls.is(cur.urls)) {
            qi = cur;
            break;
          }
        }
        val = _urls.values();
        if (qi) {
          callback && (qi.load || qi.callbacks.push(callback));
          callback && (qi.load && callback());
        } else {
          q.push({
            urls: _urls,
            callbacks: callback ? [callback] : [],
            load: false
          });
          for (i = 0; i < val.length; i++) {
            node = null, url = val[i];
            if (s[url] === undefined) {
              (type === 'js' ) && (node = createNode('script', { src: url }));
              (type === 'css') && (node = createNode('link', { rel: 'stylesheet', href: url }));
              if (node) {
                node.onload = (function(type, url) {
                  return function() {
                    end(type, url);
                  };
                })(type, url);
                (doc.head || doc.body).appendChild(node);
                s[url] = false;
              }
            }
          }
        }
      }
    };
    return {
      js: function(url, callback) {
        load('js', url, callback);
      },
      css: function(url, callback) {
        load('css', url, callback);
      }
    };
  })(this.document);
})();
</script><script>
  (function() {
    var TEXT_VARIABLES = {
      version: '2.2.4',
      sources: {
        font_awesome: 'https://use.fontawesome.com/releases/v5.0.13/css/all.css',
        jquery: 'https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js',
        leancloud_js_sdk: '//cdn.jsdelivr.net/npm/leancloud-storage@3.13.2/dist/av-min.js',
        chart: 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js',
        gitalk: {
          js: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.js',
          css: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.css'
        },
        valine: 'https://unpkg.com/valine/dist/Valine.min.js',
        mathjax: 'https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML',
        mermaid: 'https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js'
      },
      site: {
        toc: {
          selectors: 'h1,h2,h3'
        }
      },
      paths: {
        search_js: '/assets/search.js'
      }
    };
    window.TEXT_VARIABLES = TEXT_VARIABLES;
  })();
</script></head>
  <body>
    <div class="root" data-is-touch="false">
      <div class="layout--page js-page-root"><div class="page__main js-page-main page__viewport has-aside cell cell--auto">

      <div class="page__main-inner"><div class="page__header d-print-none"><header class="header"><div class="main">
      <div class="header__title">
        <div class="header__brand"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="76px" height="76px" viewBox="0 0 76 76" enable-background="new 0 0 76 76" xml:space="preserve">  <image id="image0" width="76" height="76" x="0" y="0"
    xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEwAAABMCAIAAABI9cZ8AAAAIGNIUk0AAHomAACAhAAA+gAAAIDo
AAB1MAAA6mAAADqYAAAXcJy6UTwAAAAGYktHRAD/AP8A/6C9p5MAAAAHdElNRQflBwgJKRMy4DHU
AAAAXnRFWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMACmlwdGMKICAgICAgMjgKMzg0MjQ5NGQwNDA0
MDAwMDAwMDAwMDBmMWMwMjZlMDAwMzUyNDY0NzFjMDIwMDAwMDIwMDA0MDAKYJo9ngAAD4RJREFU
eNrtm2tsE1fax894Lp7xeGzHzgUSbNI0YJJwSQKEWxWlUWkSKEIqq20RsBUrtewXpBatSlu1WvVT
F7XbW1RKqxaqCiEl25KkYUkpYlPEQrkkAsIlgZAEcnOcOAQntseeGXveD09z3sFODLm1+/JyhCxn
PHPm/M7znHOe838OhKqq6FEvut+7AY8hH0M+hnwM+UiWx5CPSqF+rxePGYQQBPEoQEYiEcyjqqqq
qgAWiUTgCkEQcAV/+W+HxOZSVXVkZGR4eJiiKFmWRVHs6upiWTYQCJw6dSonJyc3N1eW5cTERIZh
jEYjEOp0Op1ON3VUYiZiV6gTLCNJksvlunXr1ldffXXlyhWLxRIIBHw+3+DgIMMwCKGBgQGj0ZiW
liaKYkZGhiAI69atKygoyMzMhBtIkpwi6jRDgr8pijI8PNzT09PY2Hjq1KnGxka32+12u8cbh1HX
OY7Lysp6+eWXZ8+evXz5covFQtM0oE6+WdNSIpGIqqqiKN68eXPv3r1lZWVPPvkkwzCTsAD4Ksdx
FoulvLx8YGDA6/WGQqFwODy5tk0DJOD5/f76+vo33ngjMzOT53ltcyfpYwSBEFq4cOHRo0fdbvfw
8LAkSfCu3xQSXhkKhVpbW997772UlBTsUdMyMUIlq1atOnnypNvt9vl8sixPgnOSs6uqqgghWZab
mpoqKirq6upaW1slScJsaszwg5+iroOpteuK9nFVVQmCOHv2bE1Njd1upyiKoqhJTEKTgYQWuFyu
r7/++sCBA52dneFweDwGbYsRQiaTyWq1UhQlCILFYrHZbAzDeDwer9fb3d3d398vy3Is8KVLlzwe
D8Mwer2eoibc5gk/AF56/vz5d999t76+HlsvFu/X8YCQIAjp6enp6enJyclZWVmzZ8+madpoNHIc
R9O0TqeLRCKyLLtcrjt37nR1dd2+ffvMmTP37t3DnFevXm1vb09MTJRlmWGYiRpzYpCqqsqyXFtb
+/bbb7e0tICzafG0fyYkJGRnZ6empi5ZsiQrKyshIYFlWVgM4BMvgPBUWlpafn6+JEmBQKC6uvrz
zz/3er3wqyiKfX19kiTBmJwpS8LwcLvd+/bt++KLL/r6+mLXN+jd5ORkg8HgdDqfeeYZp9MpCALL
sgzDgLMxDANDCwixTcBBwuGwLMuCIGzbto2iqI8//tjn88HC6/V6FUUJh8Mw8Uy/JaHSO3fu7N69
u6qqClwUE+JWkiSZlpa2detWp9OZkpIiCIJer2dZlmVZLZ5OpyNJktAUpFmugZPjuNTUVJZlfT4f
QogkSb1ejwlnxJIEQbS3t7/++uvV1dXhcBhpAjf4TlFUenp6cXHx0qVL582bx/M8x3EcxwEeTdPY
PyEixc9qDfLrdE9RDMNcvXr1o48+8ng8cIOiKD6fDw/y6YdUVdXj8bz11ltVVVVjDr/09PSSkpKV
K1c6HA6e5w0GA3wCHvZMrd3G60pc54ULFzo6OrSdKAgCuPf0Q6qqGgwGP/jgg6qqqthdkiAICxYs
ePHFF3NzczmO43neaDQaDAYYhFq8h28QLJt5eXlz585ta2tDCJEkuXr16kWLFuG5aqKQ8QJ0+Km2
tvaVV15xu924EfC5ePHiDRs25OfnW61WQRCMRiOsCpPGwyUcDkuSVFlZ+emnn4qiuHLlyg0bNjgc
joSEBKvVajAYaJqeWMfF9/L29vatW7f+8ssveEerqqpery8qKtqyZcucOXN4ngdCMCDeLkwlrItE
IpIk+Xy+rq4ur9drNBppmuZ53mQyGY1GvV5PkuSEKhzXXcEhq6qqLly4oCUkSbKsrGzbtm1JSUkm
kwlejP1zeva4BEFRFMdxDocjFAopigKzKwQPk6g/3pj0er11dXWKomjrLSwsfOGFF5KSkhISEiwW
C8/zYEA8tUyRECCBCj6hf/HyM4kxGQ+yt7e3s7MTaUK2RYsWbd68efbs2Waz2WKxwEI/XQaM5QQ2
NDrxTroTx4UkCKK3t3doaAhfYVm2rKwM1okoA6LRgGHaOaelqnhjUhAEjuPwlVAodPjwYbfbvWLF
ihUrVpjNZu2eTbtjQvdvl2dIaJxAf403u4bD4Xv37u3YseP777/X7npIkuR5fsGCBcuWLTMajYsX
LxZFMTk52WazzZkzh2EYHOVoIafibDMLqSjK6dOnd+3a1dTUhCGjolaWZRVFMRgMBoPB4XDQNG02
mzMyMkpKSpJGC1Z6sNCIflvzjgsJu6pAIHDx4sU9e/acOnUqGAyCBKy9Z+xKCQIWT7vdXlRUNGvW
rJycnHnz5hmNRp7nYYbEMfrvDBmJREKhkCiKnZ2dDQ0Np0+fPnnyZHd3t6IoGOaBModOp6MoymKx
2O12q9W6ffv2oqIiQRAgKvptUB8Q1oXD4VAoFAwGRVH0er23bt26fPny7du3m5ub29vbQSkcky0K
G19PS0tzOp2lpaXPP/98cnIyRVEQJM0o5wPCukgkAtqEJEnBYDAUCkmSJIri0NBQd3d3U1PT9evX
dTrd9evXOzo6sIXHfdkorV6vX7t27e7du7OzsyFamlHOByvo4LeRSERRFKAFGUJRFDCyLMs9PT2n
T59uampyuVwDAwMejyeOSIFh1qxZ8/7778+bN4/juElEpNMJiVGxQgEFmPGnoigjIyNer7erq+vK
lStXrly5du2a2+0GIW/MoUsQxGuvvbZz505BEHien5zcPp2QsbS4YGBt8fv9bW1tdXV1J06ccLlc
ODOnhVRVddWqVZ988klaWprZbGZZ9mGMqZVkH7JTJixJ4rUuSqXG5gVgQRBsNltOTs7GjRtramoO
Hz4Mak1UW/v6+vr6+pKSkhRFgY7A+sB4GKqqhhUFEQRomQ+T3pt8flLbAlAowLAYWJZlnufNZvP8
+fMTEhL27t2rKEqs42CHhxYPDg663e6UlBSTyQTLKQQP8GC4rQ1VVKC2NmSxhEpLwwUFJMOQJPmA
TcJUciGxRevAoKAODQ253e6qqqqEhITYt+fl5dXV1bW0tPT399+4ceOzzz4rLS1NS0vbtWvXwMCA
z+eTJAlEurCiSGfPKsXFEZJUEYoQhJyaeu9vf/PcvOn1egOBQJw0yTRnmrUaHLaDXq93uVyBQCAq
JFRV9YknnmBZtr29/eDBgz/88MPNmzeDwSBCqKOjw+v14hoig4NqRQVZXk60tiKEVIJACJG9vaa/
/108c2bk1VelggJQXsYUgWYwnQ6oNE03Nzd/++23OGzAHgTN2r9//5kzZ27fvg1iJ0LIaDSuWbMG
lB69Xk96vcSbb1KHDhGhEOARMPcQBAqFDMePI5dr8B//UPPyQJoZYyRPr7vGeu/du3e3b98+Zi+w
LGu1WnG8jluWlZV1+PDha9eu9fb2BgKB0IEDEZZVCSJCECpC2n8RhCIEEUHo7vr1HU1N/f39fr8f
Rr62zOA5HlVVJUnau3dvZWXlmFNCMBi8e/euOrrbVlWVZdm1a9fu3LkTkkIURSFZ1v3730QwiA14
n7MgRKgqgZCpvp6orfX7/RCcRN02U+4K08+xY8f27dvn9/vHm/cwHk3Ts2bN2rhxY0lJSWJiIoQH
er2ecLmIxkbos3FfRhBkIJB48OCA0xkoKNDpdCzLziAknlcURamsrHznnXe6u7vHi3jAl0iSzMzM
LC4uzs/Ph1S8IAgmk4nneZqmdf/6l66tDXaxcd6KCIJvbibefHPor3/1rVtnsVhmBBJjyLLc2tpa
UVHx5Zdfut3uMQnhfrPZ7HQ6Fy9eXFhY6HA4IH0Ce06Yk3R9fURFBZ5v4r0dIYIgDK2tuj17+m02
NGfOdEJqTdfT03P27NlLly7V1tbeuHEjNmqFPymKMhgMdrt906ZNy5YtM5vNgAdsoJ7AblPp6KBa
WtSxRmNUwfOtvqODPnIEbdo0PZDqaGIrFApdvny5pqbm2LFjzc3NcBYlKj+Lv9vt9qeffnrJkiVz
585NTk7mOA6kE9iIMAxzn4SLD3TFd1ctLUJUe3vUxcmfGUAIBYPBixcvfvfdd1VVVZ2dnVpxJMpF
wTmLi4ufffZZGHjcaNGm97SBaDgcjjid0lNPMUePTmhvEonpjgmn09FoqquhoeHQoUNHjhzp6elB
YykD+IrFYsnKyiotLS0oKDCZTNrcHuBFZZ3/t1itob/8hWxooPr7H9KMCssO5uWlTA4S4w0ODv70
008nTpw4fvx4T0+POqrfjYnHMExubu7GjRsXLlxotVo5joO1AeYVbXYodo2B65GCAmn1aqq6+oEe
CzfcnT/f89RTE7YktD4YDHZ2dv744481NTUNDQ0jIyPxrYcQSkpKWr9+fVlZWUpKCqQu8dSiTTzH
ebVOp2MEQdq8Wf+f/5AezwObqrBsT0kJSokyZFxIaKsoiufOnfvmm28aGxtv3LgBQk6s9bRPWa3W
lStXFhcXL1myBPKWgiDg5OzD4KHRNEE4HEZFRf4//9lYXq4TxXh3q6pr+fJ7q1bx90cC40JC6wOB
wLlz5yorK48cOdLb24t3sbF42IA6nS4zM3Pbtm1Lly4Fz8T+CQvDhJJfvyazDIbAjh1hv9+8f79O
FMf2W1X1Ohydf/wjk5RkNBofDAkM169f//DDD+vq6uAI53iKo3YXn52dXVxcvGzZsvT0dIynTc5O
VGIFCYKmab3NJr766l2WtXz1FeX1otHVBTfLn5TU8qc/STk5VqNREIToesZ0ua6urpdeeunnn39W
788LjGk9juNSUlLy8/Ofe+65jIwMfHgAZ76mmNsDkUEURdHrRdXVln37uNZWYlQNjJDksMNxc8uW
kaIiOMdmNpujNuhju2tbW9v58+dRjEYe9afBYMjNzS0sLMzJyZk1axacGcB4OHCZogYHxoTv/j/8
wb1gAffPfxoaGwm/P2ixDC1aNFBYGMnIsAqC2WyGlGlUDWND2mw2u93e0tIS+5PBYLBYLKmpqVlZ
WdnZ2dnZ2VarFU4kQeCiXR6mJQWAnRaAxdzcQEbGiNsdGh6W9HqJ51mGgc7F5/Wia4h1xXA4HAwG
6+vry8vLL126BHvQ5ORkh8Nht9vT09Ptdjs+cEXTNMuyOHCZ+tGP8QqMfJCOQqEQaPkQP9I0rR8t
2rxwPEjIC4RCoa6uro6OjqGhIVmWbTYbeAKMMYjCgAoHZTinP3OCP9byQSuDKQNySnHePgakqqqg
r0CeJxgMYlEU6sKc+ChgnMBl2kuUtIFFszhvH3ezp9XFIbEBqzNGwt32+2aRH6bEy09iHRXvqqIK
+i84DzAlSIx6393/F5AmDPlolP8X/7XwMeSjUh5DPirlfwA1QTCTlERFOgAAACV0RVh0ZGF0ZTpj
cmVhdGUAMjAyMS0wNy0wOFQxNzo0MDozOCswMzowMN3pZPAAAAAldEVYdGRhdGU6bW9kaWZ5ADIw
MjEtMDctMDhUMTc6NDA6MzgrMDM6MDCstNxMAAAAAElFTkSuQmCC" />
</svg>
<a title="Tutorials, Java Tutorials,DevOps Tutorials,Spring Tutorial,SpringBoot Tutorials, Docker,Chef,Jenkins,Git,BitBucket,Bamboo,AWS,Kubernetes,Puppet,Ansible,Nagios." href="/">SatyaCodes</a></div><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></div><nav class="navigation">
        <ul><li class="navigation__item"><a href="/posts.html">AllPosts</a></li><li class="navigation__item"><a href="/tutorials.html">Tutorials</a></li><li class="navigation__item"><a href="/java.html">Java</a></li><li class="navigation__item"><a href="/devops.html">DevOps</a></li><li class="navigation__item"><a href="/books.html">Books</a></li><li class="navigation__item"><a href="/interview-questions.html">InterviewQ's</a></li><li><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></li></ul>
      </nav></div>
  </header>
</div><div class="page__content"><div class ="main"><div class="grid grid--reverse">

              <div class="col-aside d-print-none js-col-aside"><aside class="page__aside js-page-aside"><div class="toc-aside js-toc-root"></div></aside></div>

              <div class="col-main cell cell--auto"><!-- start custom main top snippet -->

<!-- end custom main top snippet --><article itemscope itemtype="http://schema.org/Article"><div class="article__header"><header><h1>Jenkins – Jenkins Pipeline for SpringBoot Application JFrog + Docker + Kubernetes + Azure ACS & AKS</h1></header></div><meta itemprop="headline" content="Jenkins – Jenkins Pipeline for SpringBoot Application JFrog + Docker + Kubernetes + Azure ACS & AKS"><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=Jenkins">Jenkins</a>
            </li></ul><ul class="right-col menu"><li><i class="far fa-calendar-alt"></i> <span>Aug 11, 2021</span>
            </li></ul></div><meta itemprop="author" content="Satya Kaveti"/><meta itemprop="datePublished" content="2021-08-11T08:00:00+00:00">
    <meta itemprop="keywords" content="Jenkins"><div class="js-article-content"><div class="layout--article"><!-- start custom article top snippet -->

<!-- end custom article top snippet --><div class="article__content" itemprop="articleBody"><h1 id="jenkins--jenkins-pipeline-for-springboot-application-jfrog--docker--kubernetes--azure-acs--aks">Jenkins – Jenkins Pipeline for SpringBoot Application JFrog + Docker + Kubernetes + Azure ACS &amp; AKS</h1>

<p><img src="media/29744ec9e49013476f817de70c392361.png" alt="" /></p>

<p><img src="media/2dabd9bb5c761830b85b6e4d0aa7a92c.png" alt="" /></p>

<p><br /></p>

<h2 id="1configure-springboot-project">1.Configure SpringBoot Project</h2>

<p>We have SpringBoot application in Github.</p>

<p><a href="https://github.com/smlcodes/Docker-SpringBoot-EmployeeServices.git">https://github.com/smlcodes/Docker-SpringBoot-EmployeeServices.git</a></p>

<p>we have removed MySQL dependency from docker because we do not require separate
MySQL instance for each Image.</p>

<p>Build &amp; Run the GitHub code.</p>

<p><img src="media/f7375fd89a43acaf32a522cc7de1a57e.png" alt="" /></p>

<p><br /></p>

<h2 id="2create-mysql-database-in-azure">2.Create MySQL Database in Azure</h2>

<p><a href="https://docs.microsoft.com/en-us/azure/mysql/quickstart-create-mysql-server-database-using-azure-portal">https://docs.microsoft.com/en-us/azure/mysql/quickstart-create-mysql-server-database-using-azure-portal</a></p>

<p><br /></p>

<h2 id="3manual-docker-image-for-springboot-project">3.Manual Docker Image for SpringBoot Project</h2>

<p>To containerize an application, we enclose our application inside a container
image and publish that image to a shared registry. The container runtime pulls
this image from the registry, unpacks the image, and runs the application inside
it.</p>

<p><br /></p>

<h3 id="a-building-a-container-image-the-conventional-way">a. Building a Container Image the Conventional Way</h3>

<p><strong>1.Creating a</strong> <code class="language-plaintext highlighter-rouge">Dockerfile</code></p>

<p>A <code class="language-plaintext highlighter-rouge">Dockerfile</code> is a plain text file that contains instructions from which a
Docker image is built. Create a <code class="language-plaintext highlighter-rouge">Dockerfile</code> in the project’s root folder.</p>

<p>A <code class="language-plaintext highlighter-rouge">Dockerfile</code> contains the commands below.</p>

<ul>
  <li>
    <p><strong>FROM</strong>: directive sets the image on which the container will be based on.</p>
  </li>
  <li>
    <p><strong>RUN</strong>: executes commands in the container.</p>
  </li>
  <li>
    <p><strong>COPY</strong>: creates a copy of files from the file system in the container.</p>
  </li>
  <li>
    <p><strong>CMD</strong>: sets the executable commands within the container.</p>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Image based on JAVA Container
FROM openjdk:8-jdk-alpine
ARG JAR_FILE=target/*.jar
COPY ${JAR_FILE} Docker-EmployeeServices-1.0.jar
EXPOSE 8080
ENTRYPOINT ["java","-jar","/Docker-EmployeeServices-1.0.jar"]
</code></pre></div></div>

<p><br /></p>

<p><strong>2.Building the Application</strong></p>

<p>We first build the application with Maven. This creates an executable JAR of the
application. We need to convert this executable JAR into a Docker image for
running in a Docker engine.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn clean package
</code></pre></div></div>

<p><br /></p>

<p><strong>3. Building the Container Image</strong><br />
We need to create Docker image from jar file by running <code class="language-plaintext highlighter-rouge">docker build -t
Repository:TAGVERSION</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build -t employeeservices:latest .
</code></pre></div></div>

<p><img src="media/0ba3cebce783b846e4f6ec13549db8b8.png" alt="" /></p>

<p><br /></p>

<p>We can see our image listed with the command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker images
</code></pre></div></div>

<p><img src="media/e8b01f2b5d79cc5c6b678ea28609385d.png" alt="" /></p>

<p><br /></p>

<p>4.<strong>Viewing the Layers Inside the Container Image</strong><br />
We will use the <a href="https://github.com/wagoodman/dive">dive tool</a> to view check
layers inside the image. using <code class="language-plaintext highlighter-rouge">dive Repository:TAGVERSION</code></p>

<p><img src="media/45f2dba23ee6005ba77db8e64f3d259e.png" alt="" /></p>

<p><br /></p>

<p>5.Running Docker Image</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run --name employeeservices -d -p 8080:8080 employeeservices:latest
</code></pre></div></div>

<p><br /></p>

<p>6.Execute the command below to list all the running Docker containers.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker container ps
</code></pre></div></div>

<p><br /></p>

<p>7.Access Running application by docker URL</p>

<p><img src="media/f2934eb49fcd90d03c2cc07d508f016c.png" alt="" /></p>

<p><br /></p>

<p><br /></p>

<h3 id="b-building-using-maven">b. Building Using Maven</h3>

<p>By using Maven, we have multiple options.</p>

<ol>
  <li>
    <p>Using the integrated Spring Boot <strong>build-image</strong> goal.</p>
  </li>
  <li>
    <p>Using the <strong>jib-maven-plugin</strong> from Google.</p>
  </li>
  <li>
    <p>Using the <strong>dockerfile-maven-plugin</strong> from Spotify.</p>
  </li>
</ol>

<h4 id="1using-the-integrated-spring-boot-build-image-goal">1.Using the integrated Spring Boot build-image goal.</h4>

<p>Spring Boot comes pre-shipped with its own plugin for building Docker images and
you don’t need to make any changes. It is available through the standard
<strong>spring-boot-starter-parent</strong> that is included in your <strong>pom.xml.</strong></p>

<p>you <strong>do not need to write a Dockerfile</strong> either and the plugin takes care of
Spring-recommended security, memory, and performance optimizations. if there is
a <strong>Dockerfile</strong> located within your source code repository, <strong>it will be
ignored</strong>.</p>

<p><br /></p>

<p>To create Docker image, just run</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn spring-boot:build-image
</code></pre></div></div>

<p>make sure project name must be on small letters &amp; no special symbols</p>

<p><img src="media/0a31ee570319456a1cf4cf4cf73b5085.png" alt="" /></p>

<p><img src="media/2da7982027a1ac935bb67648dd9472ff.png" alt="" /></p>

<p><br /></p>

<h4 id="2-using-the-jib-maven-plugin-from-google">2. Using the jib-maven-plugin from Google</h4>

<p>Jib is a Maven and Gradle plugin for creating Docker images for Java
applications.</p>

<ul>
  <li>
    <p><strong>it does not require Docker to be installed locally</strong></p>
  </li>
  <li>
    <p><strong>it does not require you to have written a Dockerfile</strong></p>
  </li>
  <li>
    <p>Best Choice for Continuous Integration / build server</p>
  </li>
  <li>
    <p><a href="https://github.com/GoogleContainerTools/jib/tree/master/jib-maven-plugin">jib-maven-plugin</a>
will build and push the image straight to the Docker registry of choice.</p>
  </li>
</ul>

<p><u>  **Using Local System** </u><br />
Since we are not pushing to a Docker registry, we will tell Jib to use our local
Docker installation by using the <strong>dockerBuild</strong> goal.</p>

<p>pom.xml</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;plugin&gt;
	&lt;groupId&gt;com.google.cloud.tools&lt;/groupId&gt;
	&lt;artifactId&gt;jib-maven-plugin&lt;/artifactId&gt;
	&lt;version&gt;2.6.0&lt;/version&gt;
	&lt;configuration&gt;
		&lt;from&gt;
			&lt;image&gt;gcr.io/distroless/java:8&lt;/image&gt;
		&lt;/from&gt;
		&lt;to&gt;
			&lt;image&gt;docker-employeeservices:${project.version}&lt;/image&gt;
		&lt;/to&gt;
	&lt;/configuration&gt;
&lt;/plugin&gt;
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Builds to a container image and pushes registry.
$ mvn compile jib:build

# Builds to a Docker daemon in local system.
$ mvn compile jib:dockerBuild

# This builds and saves your image as tarball to target/jib-image.tar
$ mvn compile jib:buildTar

# you can load tar Image into docker with
docker load --input target/jib-image.tar
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ 
</code></pre></div></div>

<p><img src="media/e25a5822a8b231f93d0adedf246c2879.png" alt="" /></p>

<p>The only configuration we needed is to provide was &lt;to&gt;&lt;image&gt;, which is the
name of our Docker image. We can now use that plugin to create a Docker image
that will be available on our local Docker daemon.</p>

<p>To build the Docker image, run the command, without maven dependency in pom.xml</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn compile com.google.cloud.tools:jib-maven-plugin:2.3.0:dockerBuild
</code></pre></div></div>

<p><br /></p>

<p><u> **Using DockerHub** </u></p>

<p>1.add registry credentials to the Maven <strong>Maven\conf\settings.xml</strong> file</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	&lt;server&gt;
	  &lt;id&gt;registry.hub.docker.com&lt;/id&gt;
		&lt;username&gt;smlcodes&lt;/username&gt;
		&lt;password&gt;passw0rd@&lt;/password&gt;
	&lt;/server&gt;
</code></pre></div></div>

<p>2.Update pom.xml</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;plugin&gt;
	&lt;groupId&gt;com.google.cloud.tools&lt;/groupId&gt;
	&lt;artifactId&gt;jib-maven-plugin&lt;/artifactId&gt;
	&lt;version&gt;2.6.0&lt;/version&gt;
	&lt;configuration&gt;
		&lt;from&gt;
			&lt;image&gt;gcr.io/distroless/java:8&lt;/image&gt;
		&lt;/from&gt;
		&lt;to&gt;
			&lt;image&gt;smlcodes/docker-employeeservices:${project.version}&lt;/image&gt;
		&lt;/to&gt;
	&lt;/configuration&gt;
&lt;/plugin&gt;
</code></pre></div></div>

<ul>
  <li>
    <p>Typically, you don’t need to provide <strong>&lt;from&gt;</strong> as by default, as it uses
a distro-less Java 8 image. However, I have used Java 11, so I have
explicitly mentioned that here. Moreover, depending on your use case, you
may want to use a different base image</p>
  </li>
  <li>
    <p><strong>&lt;image&gt;</strong> This refers to the target image that will pushed to the
container registry<strong>.</strong></p>
  </li>
</ul>

<p><strong>To Build &amp; Publish docker image</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn compile jib:build
</code></pre></div></div>

<p><img src="media/8751c9abca4abe6e88c8826794792c1d.png" alt="" /></p>

<p><strong>Check Docker HUB online</strong></p>

<p><img src="media/6f2307bc886834e7608361d2eb83ec52.png" alt="" /></p>

<p>I have used a Docker registry, but you can use any cloud provider’s (ECS, GCR,
ACR) container registry. For other options available for use with the plugin,
you can refer to the
<a href="https://github.com/GoogleContainerTools/jib/tree/master/jib-maven-plugin">documentation</a>.</p>

<p><br /></p>

<h4 id="3using-the-dockerfile-maven-plugin">3.Using the dockerfile-maven-plugin</h4>

<p>Add your Dockerfile into your root directory alongside your pom.xml.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;plugin&gt;
	&lt;groupId&gt;com.spotify&lt;/groupId&gt;
	&lt;artifactId&gt;dockerfile-maven-plugin&lt;/artifactId&gt;
	&lt;version&gt;1.4.13&lt;/version&gt;
	&lt;executions&gt;
		&lt;execution&gt;
			&lt;id&gt;default&lt;/id&gt;
			&lt;goals&gt;
				&lt;goal&gt;build&lt;/goal&gt;
				&lt;goal&gt;push&lt;/goal&gt;
			&lt;/goals&gt;
		&lt;/execution&gt;
	&lt;/executions&gt;
	&lt;configuration&gt;
		&lt;repository&gt;${project.artifactId}&lt;/repository&gt;
		&lt;tag&gt;${project.version}&lt;/tag&gt;
		&lt;buildArgs&gt;
            &lt;JAR_FILE&gt;target/${project.build.finalName}.jar&lt;/JAR_FILE&gt;
	       &lt;/buildArgs&gt;
&lt;/configuration&gt;
&lt;/plugin&gt;
</code></pre></div></div>

<p><br /></p>

<p><br /></p>

<h2 id="4jenkins-configuration">4.Jenkins Configuration</h2>

<p>Downoad &amp; Start Jenkins from <a href="https://www.jenkins.io/download/"><strong>here</strong></a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd C:\Docker\Jenkins
 
java -jar jenkins.war --httpPort=2222

echo "Jenkins Started . . . "
</code></pre></div></div>

<p><br /></p>

<p><strong>Login to Jenkins</strong></p>

<p><a href="http://localhost:2222/">http://localhost:2222/</a></p>

<p>admin/admin</p>

<p><br /></p>

<p><br /></p>

<h2 id="5docker-image-push-to-jfrog-artifactory">5.Docker Image PUSH to JFrog Artifactory</h2>

<p>Go to JFrog Website: <a href="https://jfrog.com/start-free">https://jfrog.com/start-free</a> create an account, login</p>

<p>On your system cmdline</p>

<p><code class="language-plaintext highlighter-rouge">docker login satyajohnny.jfrog.io</code></p>

<p><img src="media/1d51e74cbc204b5e6cd91061e38faa6b.png" alt="" /></p>

<p>From next time onwards it won’t ask for Credentials</p>

<p>Go to Administration &gt; Add Repository &gt; Local &gt; Select : Docker &gt; Name :
<strong>jenkins-docker-images</strong> <img src="media/e2d0a3c744399ed3bf8d8e0383dbc0b8.png" alt="" /></p>

<p>To Integrate with Jenkins, follow
<a href="http://satyacodes.ml/jenkins/jfrog-integration">http://satyacodes.ml/jenkins/jfrog-integration</a></p>

<p><img src="media/177c6ae40de0841e443fbbca9df43e67.png" alt="" /></p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pipeline</span> <span class="p">{</span>
    <span class="n">agent</span> 
 
   	<span class="n">tools</span> <span class="p">{</span>
   	<span class="c">//Java, Maven Configured in Globol tools configuration. and here the names we provided for configuration</span>
   	 	 <span class="err">'</span><span class="n">Java8</span><span class="err">'</span>
    	 <span class="err">'</span><span class="n">Maven</span><span class="err">'</span>
  	<span class="p">}</span>
    <span class="n">stages</span> <span class="p">{</span>
        <span class="n">stage</span> <span class="p">(</span><span class="err">'</span><span class="n">Clone</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>
            <span class="c">//github-creds are github login creds, configured in Credencial Manager </span>
            	<span class="n">git</span> <span class="n">branch</span><span class="o">:</span> <span class="err">'</span><span class="n">main</span><span class="err">'</span><span class="p">,</span>
    				<span class="n">credentialsId</span><span class="o">:</span> <span class="err">'</span><span class="n">github</span><span class="o">-</span><span class="n">creds</span><span class="err">'</span><span class="p">,</span>
    				<span class="n">url</span><span class="o">:</span> <span class="err">'</span><span class="n">https</span><span class="o">:</span><span class="c">//github.com/smlcodes/Docker-SpringBoot-EmployeeServices.git'</span>
                
            <span class="p">}</span>
        <span class="p">}</span>
 
             <span class="c">/* 
                    Artifactory-1 - similarly like Globol tool configuration. 
                    				But we are configured manually, passed as ServerID
                    				
                    rtMavenResolver - To get Jars of Pom.xml	
                    rtMavenDeployer - To Deploy Newly created jars on Build			
            */</span>
        <span class="n">stage</span> <span class="p">(</span><span class="err">'</span><span class="n">Artifactory</span> <span class="n">Configuration</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>

					<span class="n">rtServer</span> <span class="p">(</span>
					    <span class="o">:</span> <span class="err">'</span><span class="n">Artifactory</span><span class="o">-</span><span class="m">1</span><span class="err">'</span><span class="p">,</span>
					    <span class="n">url</span><span class="o">:</span> <span class="s">"https://satyajohnny.jfrog.io/artifactory"</span><span class="p">,</span>
                    	<span class="n">credentialsId</span><span class="o">:</span> <span class="s">"jfrog-creds"</span>
					<span class="p">)</span>
				
				<span class="n">rtMavenResolver</span> <span class="p">(</span>
                    <span class="o">:</span> <span class="err">'</span><span class="n">maven</span><span class="o">-</span><span class="n">resolver</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">serverId</span><span class="o">:</span> <span class="err">'</span><span class="n">Artifactory</span><span class="o">-</span><span class="m">1</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">releaseRepo</span><span class="o">:</span> <span class="err">'</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">snapshotRepo</span><span class="o">:</span> <span class="err">'</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">libs</span><span class="o">-</span><span class="n">snapshot</span><span class="err">'</span>
                <span class="p">)</span>  
                 
                <span class="n">rtMavenDeployer</span> <span class="p">(</span>
                    <span class="o">:</span> <span class="err">'</span><span class="n">maven</span><span class="o">-</span><span class="n">deployer</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">serverId</span><span class="o">:</span> <span class="err">'</span><span class="n">Artifactory</span><span class="o">-</span><span class="m">1</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">releaseRepo</span><span class="o">:</span> <span class="err">'</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">local</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">snapshotRepo</span><span class="o">:</span> <span class="err">'</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">libs</span><span class="o">-</span><span class="n">snapshot</span><span class="o">-</span><span class="n">local</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">threads</span><span class="o">:</span> <span class="m">6</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">Build</span> <span class="n">Maven</span> <span class="n">Project</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>
                <span class="n">rtMavenRun</span> <span class="p">(</span>
                    <span class="n">tool</span><span class="o">:</span> <span class="err">'</span><span class="n">Maven</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">pom</span><span class="o">:</span> <span class="err">'</span><span class="n">pom</span><span class="o">.</span><span class="n">xml</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">goals</span><span class="o">:</span> <span class="err">'</span><span class="o">-</span><span class="n">X</span> <span class="n">clean</span> <span class="n">install</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">deployerId</span><span class="o">:</span> <span class="s">"maven-deployer"</span><span class="p">,</span>
                    <span class="n">resolverId</span><span class="o">:</span> <span class="s">"maven-resolver"</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>After Running this New jars added to JFrog
Artifactory<img src="media/a75d5558bf6c56d6c352641c060a2410.png" alt="" /></p>

<h2 id="5docker-image-push-to-docker-hub">5.Docker Image Push to Docker HUB</h2>

<p>First, create a environment to save docker image information’s.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dockerImage = ''
</code></pre></div></div>

<p>Change the build stage to save build information in environment.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dockerImage = docker.build registry + ":$BUILD_NUMBER"
</code></pre></div></div>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pipeline</span> <span class="p">{</span>

    <span class="n">environment</span> <span class="p">{</span>
        <span class="n">registry</span> <span class="o">=</span> <span class="s">"smlcodes/docker-employeeservices"</span>
        <span class="n">registryCredential</span> <span class="o">=</span> <span class="err">'</span><span class="n">docker</span><span class="o">-</span><span class="n">creds</span><span class="err">'</span>
        <span class="n">dockerImage</span> <span class="o">=</span> <span class="err">''</span>
    <span class="p">}</span>
    <span class="n">agent</span> 

    <span class="n">tools</span> <span class="p">{</span>
         <span class="err">'</span><span class="n">Java8</span><span class="err">'</span>
         <span class="err">'</span><span class="n">Maven</span><span class="err">'</span>
    <span class="p">}</span>
    
    
    
    <span class="n">stages</span> <span class="p">{</span>
        <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">Clone</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>
                <span class="n">git</span> <span class="n">branch</span><span class="o">:</span> <span class="err">'</span><span class="n">main</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">credentialsId</span><span class="o">:</span> <span class="err">'</span><span class="n">github</span><span class="o">-</span><span class="n">creds</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">url</span><span class="o">:</span> <span class="err">'</span><span class="n">https</span><span class="o">:</span><span class="c">//github.com/smlcodes/docker-springboot-employeeservices.git'</span>

            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c">/* 
                    Artifactory-1 - similarly like Globol tool configuration. 
                    				But we are configured manually, passed as ServerID
                    				
                    rtMavenResolver - To get Jars of Pom.xml	
                    rtMavenDeployer - To Deploy Newly created jars on Build			
            */</span>
        <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">Artifactory</span> <span class="n">Configuration</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>

                <span class="n">rtServer</span><span class="p">(</span>
                    <span class="o">:</span> <span class="err">'</span><span class="n">Artifactory</span><span class="o">-</span><span class="m">1</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">url</span><span class="o">:</span> <span class="s">"https://satyajohnny.jfrog.io/artifactory"</span><span class="p">,</span>
                    <span class="n">credentialsId</span><span class="o">:</span> <span class="s">"jfrog-creds"</span>
                <span class="p">)</span>

                <span class="n">rtMavenResolver</span><span class="p">(</span>
                    <span class="o">:</span> <span class="err">'</span><span class="n">maven</span><span class="o">-</span><span class="n">resolver</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">serverId</span><span class="o">:</span> <span class="err">'</span><span class="n">Artifactory</span><span class="o">-</span><span class="m">1</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">releaseRepo</span><span class="o">:</span> <span class="err">'</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">snapshotRepo</span><span class="o">:</span> <span class="err">'</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">libs</span><span class="o">-</span><span class="n">snapshot</span><span class="err">'</span>
                <span class="p">)</span>

                <span class="n">rtMavenDeployer</span><span class="p">(</span>
                    <span class="o">:</span> <span class="err">'</span><span class="n">maven</span><span class="o">-</span><span class="n">deployer</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">serverId</span><span class="o">:</span> <span class="err">'</span><span class="n">Artifactory</span><span class="o">-</span><span class="m">1</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">releaseRepo</span><span class="o">:</span> <span class="err">'</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">local</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">snapshotRepo</span><span class="o">:</span> <span class="err">'</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">libs</span><span class="o">-</span><span class="n">snapshot</span><span class="o">-</span><span class="n">local</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">threads</span><span class="o">:</span> <span class="m">6</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">Build</span> <span class="n">Maven</span> <span class="n">Project</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>
                <span class="n">rtMavenRun</span><span class="p">(</span>
                    <span class="n">tool</span><span class="o">:</span> <span class="err">'</span><span class="n">Maven</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">pom</span><span class="o">:</span> <span class="err">'</span><span class="n">pom</span><span class="o">.</span><span class="n">xml</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">goals</span><span class="o">:</span> <span class="err">'</span><span class="o">-</span><span class="n">U</span> <span class="n">clean</span> <span class="n">install</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">deployerId</span><span class="o">:</span> <span class="s">"maven-deployer"</span><span class="p">,</span>
                    <span class="n">resolverId</span><span class="o">:</span> <span class="s">"maven-resolver"</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">Build</span> <span class="n">Docker</span> <span class="n">Image</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>

                 <span class="s">"</span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s"> ***************************************"</span>
                 <span class="s">"         Build Docker Image"</span>
                 <span class="s">"***************************************</span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s">"</span>

                <span class="n">script</span> <span class="p">{</span>
                    <span class="n">docker</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="s">"satyajohnny.jfrog.io/"</span> <span class="o">+</span> <span class="s">"docker-employeeservices:2.0.${env.BUILD_NUMBER}"</span><span class="p">)</span>
                    <span class="n">dockerImage</span> <span class="o">=</span> <span class="n">docker</span><span class="o">.</span><span class="n">build</span> <span class="n">registry</span> <span class="o">+</span> <span class="s">":$BUILD_NUMBER"</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>


        <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">Push</span> <span class="n">Image</span> <span class="n">to</span> <span class="n">DockerHub</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>
                <span class="n">script</span> <span class="p">{</span>

                     <span class="s">"</span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s"> ***************************************"</span>
                     <span class="s">"         Push Image to DockerHub"</span>
                     <span class="s">"*********************************</span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s">"</span>
                    <span class="n">docker</span><span class="o">.</span><span class="n">withRegistry</span><span class="p">(</span><span class="err">''</span><span class="p">,</span> <span class="n">registryCredential</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">dockerImage</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
         
    <span class="p">}</span> <span class="c">//Stages End</span>

<span class="p">}</span> <span class="c">//Pipeline End</span>
</code></pre></div></div>

<p><img src="media/4afb89e9c6f5b3aaa8d66aa28e01b342.png" alt="" /></p>

<p><img src="media/b2ea3326a03ee99de345a43719267574.png" alt="" /></p>

<p><br /></p>

<p><br /></p>

<h2 id="5docker-image-push-to-azure-container-registry">5.Docker Image Push to Azure Container Registry</h2>

<p>To Quick start Azure Container Registry follow</p>

<p><a href="https://docs.microsoft.com/en-us/azure/container-registry/container-registry-get-started-portal">https://docs.microsoft.com/en-us/azure/container-registry/container-registry-get-started-portal</a></p>

<p>Select <strong>Create a resource</strong> &gt; <strong>Containers</strong> &gt; <strong>Container Registry</strong>.
<img src="media/61234f437de957d4afb0dcc797b5d396.png" alt="" /></p>

<p><img src="media/1fbe7e7d51477d24b262e1cc7137e237.png" alt="" /></p>

<p>Go to Access Keys in Container Registry and enable the admin user, then use the
autogenerated credentials to login via
Docker<img src="media/6539a81f70b2caa63f6dbbf5d58e8fd8.png" alt="" /></p>

<p>Configure these credentials in Jenkins with name <code class="language-plaintext highlighter-rouge">'azurecontainer-creds'</code></p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pipeline</span> <span class="p">{</span>

    <span class="n">environment</span> <span class="p">{</span>    	
        <span class="n">dockerregistry</span> <span class="o">=</span> <span class="s">"smlcodes/docker-employeeservices"</span>
        <span class="n">dockercreds</span> <span class="o">=</span> <span class="err">'</span><span class="n">docker</span><span class="o">-</span><span class="n">creds</span><span class="err">'</span>
        <span class="n">dockerHubImage</span> <span class="o">=</span> <span class="err">''</span>
        
        <span class="c">//Go to Access Keys in Container Registry and enable the admin user, then use the autogenerated credentials to login via Docker</span>
        <span class="n">azureregistry</span> <span class="o">=</span> <span class="s">"satyajohnnycontainer.azurecr.io"</span>
        <span class="n">azurecreds</span> <span class="o">=</span> <span class="err">'</span><span class="n">azurecontainer</span><span class="o">-</span><span class="n">creds</span><span class="err">'</span>
        <span class="n">azureImage</span> <span class="o">=</span> <span class="err">''</span> 
             
    <span class="p">}</span>
    <span class="n">agent</span> 

    <span class="n">tools</span> <span class="p">{</span>
         <span class="err">'</span><span class="n">Java8</span><span class="err">'</span>
         <span class="err">'</span><span class="n">Maven</span><span class="err">'</span>
    <span class="p">}</span>
    
    
    
    <span class="n">stages</span> <span class="p">{</span>
        <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">Clone</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>
                <span class="n">git</span> <span class="n">branch</span><span class="o">:</span> <span class="err">'</span><span class="n">main</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">credentialsId</span><span class="o">:</span> <span class="err">'</span><span class="n">github</span><span class="o">-</span><span class="n">creds</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">url</span><span class="o">:</span> <span class="err">'</span><span class="n">https</span><span class="o">:</span><span class="c">//github.com/smlcodes/docker-springboot-employeeservices.git'</span>

            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">Artifactory</span> <span class="n">Configuration</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>

                <span class="n">rtServer</span><span class="p">(</span>
                    <span class="o">:</span> <span class="err">'</span><span class="n">Artifactory</span><span class="o">-</span><span class="m">1</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">url</span><span class="o">:</span> <span class="s">"https://satyajohnny.jfrog.io/artifactory"</span><span class="p">,</span>
                    <span class="n">credentialsId</span><span class="o">:</span> <span class="s">"jfrog-creds"</span>
                <span class="p">)</span>

                <span class="n">rtMavenResolver</span><span class="p">(</span>
                    <span class="o">:</span> <span class="err">'</span><span class="n">maven</span><span class="o">-</span><span class="n">resolver</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">serverId</span><span class="o">:</span> <span class="err">'</span><span class="n">Artifactory</span><span class="o">-</span><span class="m">1</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">releaseRepo</span><span class="o">:</span> <span class="err">'</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">snapshotRepo</span><span class="o">:</span> <span class="err">'</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">libs</span><span class="o">-</span><span class="n">snapshot</span><span class="err">'</span>
                <span class="p">)</span>

                <span class="n">rtMavenDeployer</span><span class="p">(</span>
                    <span class="o">:</span> <span class="err">'</span><span class="n">maven</span><span class="o">-</span><span class="n">deployer</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">serverId</span><span class="o">:</span> <span class="err">'</span><span class="n">Artifactory</span><span class="o">-</span><span class="m">1</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">releaseRepo</span><span class="o">:</span> <span class="err">'</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">local</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">snapshotRepo</span><span class="o">:</span> <span class="err">'</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">libs</span><span class="o">-</span><span class="n">snapshot</span><span class="o">-</span><span class="n">local</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">threads</span><span class="o">:</span> <span class="m">6</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">Build</span> <span class="n">Maven</span> <span class="n">Project</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>
                <span class="n">rtMavenRun</span><span class="p">(</span>
                    <span class="n">tool</span><span class="o">:</span> <span class="err">'</span><span class="n">Maven</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">pom</span><span class="o">:</span> <span class="err">'</span><span class="n">pom</span><span class="o">.</span><span class="n">xml</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">goals</span><span class="o">:</span> <span class="err">'</span><span class="o">-</span><span class="n">U</span> <span class="n">clean</span> <span class="n">install</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">deployerId</span><span class="o">:</span> <span class="s">"maven-deployer"</span><span class="p">,</span>
                    <span class="n">resolverId</span><span class="o">:</span> <span class="s">"maven-resolver"</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">Build</span> <span class="n">Docker</span> <span class="n">Image</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>

                <span class="n">script</span> <span class="p">{</span>
<span class="n">azureImage</span> <span class="o">=</span> <span class="n">docker</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="s">"satyajohnnycontainer.azurecr.io/"</span> <span class="o">+</span> <span class="s">"docker-employeeservices:2.0.${env.BUILD_NUMBER}"</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
           <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">Push</span> <span class="n">Image</span> <span class="n">to</span> <span class="n">Azure</span> <span class="n">Container</span> <span class="n">Registry</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>
                <span class="n">script</span> <span class="p">{</span>
                    <span class="n">docker</span><span class="o">.</span><span class="n">withRegistry</span><span class="p">(</span><span class="err">'</span><span class="n">https</span><span class="o">:</span><span class="c">//satyajohnnycontainer.azurecr.io', azurecreds) {</span>
                        <span class="n">azureImage</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
          

        <span class="n">stage</span> <span class="p">(</span><span class="err">'</span><span class="n">Publish</span> <span class="n">Build</span> <span class="n">Info</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>
                <span class="n">rtPublishBuildInfo</span> <span class="p">(</span>
                    <span class="n">serverId</span><span class="o">:</span> <span class="s">"Artifactory-1"</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span> <span class="c">//Stages End</span>

<span class="p">}</span> <span class="c">//Pipeline End</span>
</code></pre></div></div>

<p><img src="media/a687c543b5f3e15d06cd1045ec3853b2.png" alt="" /></p>

<p>Now go to Azure Container Registry &gt; Services &gt; Repository , see Docker Image
published</p>

<p><img src="media/f27f28c84fea1e132558683c95da31ff.png" alt="" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#Login 
az acr login --name satyajohnnycontainer

#List images in registry
az acr repository list --name satyajohnnycontainer --output table
</code></pre></div></div>

<p><img src="media/8ce8580fc277ac45cbf66c2de07dce52.png" alt="" /></p>

<p><br /></p>

<p><br /></p>

<h2 id="6aks--azure-kubernetes-service">6.AKS – Azure Kubernetes Service</h2>

<p>AKS is a managed Kubernetes service that lets you quickly deploy and manage
clusters. We will see how to create AKS cluster in Azure cloud using Azure CLI.</p>

<p><strong>Pre-requisites:</strong></p>

<ul>
  <li>
    <p>Azure CLI is installed on your local machine.</p>
  </li>
  <li>
    <p>Account setup in Azure.</p>
  </li>
</ul>

<p><img src="media/a84f47b0c89cfb41cbb6e96781d90c64.png" alt="" /></p>

<h3 id="create-azure-container-registry">Create Azure Container Registry</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#Login to Azure
az login

#Create a resource group first.
az group create --name myResourceGroup --location eastus
</code></pre></div></div>

<p><br /></p>

<p>Run the below command to create your own private container registry using
<strong>Azure Container Registry</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az acr create --resource-group myResourceGroup --name satyajohnnycontainer --sku Standard --location eastus
</code></pre></div></div>

<p><br /></p>

<p><strong>Create AKS cluster with 2 worker nodes</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az aks create --resource-group myResourceGroup --name  --node-count 2 --enable-addons monitoring --generate-ssh-keys
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Windows\system32&gt; --resource-group myResourceGroup --name  --node-count 2 --enable-addons monitoring --generate-ssh-keys

SSH key files 'C:\Users\kavetis\.ssh\id_rsa' and 'C:\Users\kavetis\.ssh\id_rsa.pub' have been generated under ~/.ssh to allow SSH access to the VM. If using machines without permanent storage like Azure Cloud Shell without an attached file share, back up your keys to a safe location
Resource provider 'Microsoft.OperationalInsights' used by this operation is not registered. We are registering for you.
</code></pre></div></div>

<p><br /></p>

<p>Once Above cmd run completes, we can see many no. of services are created which
are required by AKS. <img src="media/95fb5d03b8a6b939c7936ed28407fcbd.png" alt="" /></p>

<p>We can see 2 Nodes inside AKS Cluster
<img src="media/c979f38ed6fe76a2ae4d94a76cf0ebbf.png" alt="" /></p>

<p><br /></p>

<h3 id="connect-to-the-cluster">Connect to the cluster</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az aks get-credentials --resource-group myResourceGroup --name  --overwrite-existing
</code></pre></div></div>

<p>To verify the connection to your cluster, use the kubectl get command to return
a list of the cluster nodes.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get nodes
</code></pre></div></div>

<p><img src="media/dbb44d092d3718d5674d343a8073e68f.png" alt="" /></p>

<p># List all deployments in a specific namespace</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get deployments --all-namespaces=true
</code></pre></div></div>

<p><img src="media/aca9fd734279e2fa038326e8f52d31bf.png" alt="" /></p>

<h3 id="update-jenkins-pipeline">Update Jenkins Pipeline</h3>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pipeline</span> <span class="p">{</span>
    <span class="n">agent</span> 
    <span class="n">environment</span> <span class="p">{</span>        
        <span class="n">registry</span> <span class="o">=</span> <span class="s">"smlcodes/docker-employeeservices"</span>
        <span class="n">registryCredential</span> <span class="o">=</span> <span class="err">'</span><span class="n">docker</span><span class="o">-</span><span class="n">creds</span><span class="err">'</span>
        <span class="n">dockerImage</span> <span class="o">=</span> <span class="err">''</span>
    <span class="p">}</span>
    <span class="n">stages</span> <span class="p">{</span>

        <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">checkout</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
    		 <span class="n">steps</span> <span class="p">{</span>
                <span class="n">git</span> <span class="n">branch</span><span class="o">:</span> <span class="err">'</span><span class="n">main</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">credentialsId</span><span class="o">:</span> <span class="err">'</span><span class="n">github</span><span class="o">-</span><span class="n">creds</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">url</span><span class="o">:</span> <span class="err">'</span><span class="n">https</span><span class="o">:</span><span class="c">//github.com/smlcodes/docker-springboot-employeeservices.git'</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">Artifactory</span> <span class="n">Configuration</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>

                <span class="n">rtServer</span><span class="p">(</span>
                    <span class="o">:</span> <span class="err">'</span><span class="n">Artifactory</span><span class="o">-</span><span class="m">1</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">url</span><span class="o">:</span> <span class="s">"https://satyajohnny.jfrog.io/artifactory"</span><span class="p">,</span>
                    <span class="n">credentialsId</span><span class="o">:</span> <span class="s">"jfrog-creds"</span>
                <span class="p">)</span>

                <span class="n">rtMavenResolver</span><span class="p">(</span>
                    <span class="o">:</span> <span class="err">'</span><span class="n">maven</span><span class="o">-</span><span class="n">resolver</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">serverId</span><span class="o">:</span> <span class="err">'</span><span class="n">Artifactory</span><span class="o">-</span><span class="m">1</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">releaseRepo</span><span class="o">:</span> <span class="err">'</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">snapshotRepo</span><span class="o">:</span> <span class="err">'</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">libs</span><span class="o">-</span><span class="n">snapshot</span><span class="err">'</span>
                <span class="p">)</span>

                <span class="n">rtMavenDeployer</span><span class="p">(</span>
                    <span class="o">:</span> <span class="err">'</span><span class="n">maven</span><span class="o">-</span><span class="n">deployer</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">serverId</span><span class="o">:</span> <span class="err">'</span><span class="n">Artifactory</span><span class="o">-</span><span class="m">1</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">releaseRepo</span><span class="o">:</span> <span class="err">'</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">local</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">snapshotRepo</span><span class="o">:</span> <span class="err">'</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">libs</span><span class="o">-</span><span class="n">snapshot</span><span class="o">-</span><span class="n">local</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">threads</span><span class="o">:</span> <span class="m">6</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">Build</span> <span class="n">Maven</span> <span class="n">Project</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>
                <span class="n">rtMavenRun</span><span class="p">(</span>
                    <span class="n">tool</span><span class="o">:</span> <span class="err">'</span><span class="n">Maven</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">pom</span><span class="o">:</span> <span class="err">'</span><span class="n">pom</span><span class="o">.</span><span class="n">xml</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">goals</span><span class="o">:</span> <span class="err">'</span><span class="o">-</span><span class="n">U</span> <span class="n">clean</span> <span class="n">install</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">deployerId</span><span class="o">:</span> <span class="s">"maven-deployer"</span><span class="p">,</span>
                    <span class="n">resolverId</span><span class="o">:</span> <span class="s">"maven-resolver"</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">Build</span> <span class="n">Docker</span> <span class="n">image</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>
                <span class="n">script</span> <span class="p">{</span>
                    <span class="n">dockerImage</span> <span class="o">=</span> <span class="n">docker</span><span class="o">.</span><span class="n">build</span> <span class="n">registry</span> <span class="o">+</span> <span class="s">":$BUILD_NUMBER"</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c">// Uploading Docker images into Docker Hub</span>
        <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">Upload</span> <span class="n">Image</span> <span class="n">to</span> <span class="n">Docker</span> <span class="n">HUB</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>
                <span class="n">script</span> <span class="p">{</span>
                    <span class="n">docker</span><span class="o">.</span><span class="n">withRegistry</span><span class="p">(</span><span class="err">''</span><span class="p">,</span> <span class="n">registryCredential</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">dockerImage</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
                        <span class="n">dockerImage</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="err">'</span><span class="n">latest</span><span class="err">'</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">Remove</span> <span class="n">Unused</span> <span class="n">docker</span> <span class="n">image</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>
                 <span class="s">"docker rmi $registry:$BUILD_NUMBER"</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">K8S</span> <span class="n">Deploy</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>
                <span class="n">script</span> <span class="p">{</span>
                    <span class="n">kubernetesDeploy</span><span class="p">(</span>
                        <span class="n">configs</span><span class="o">:</span> <span class="err">'</span><span class="n">Kubernetes</span><span class="o">.</span><span class="n">yaml</span><span class="err">'</span><span class="p">,</span>
                        <span class="n">kubeconfigId</span><span class="o">:</span> <span class="err">'</span><span class="n">aks</span><span class="o">-</span><span class="n">creds</span><span class="err">'</span><span class="p">,</span>
                        <span class="n">enableConfigSubstitution</span><span class="o">:</span> <span class="no">true</span>
                    <span class="p">)</span>

                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

<span class="n">always</span> <span class="p">{</span>
    <span class="c">// remove built docker image and prune system</span>
    <span class="nb">print</span> <span class="err">'</span><span class="n">Cleaning</span> <span class="n">up</span> <span class="n">the</span> <span class="n">Docker</span> <span class="n">system</span><span class="o">.</span><span class="err">'</span>
     <span class="err">'</span><span class="n">docker</span> <span class="n">system</span> <span class="n">prune</span> <span class="o">-</span><span class="n">f</span><span class="err">'</span>
<span class="p">}</span>
</code></pre></div></div>

<p><br /></p>

<p><code class="language-plaintext highlighter-rouge">Kubernetes.yaml</code> – For Docker HUB</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">docker-employeeservices-manual</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">2</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">docker-employeeservices-manual</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">docker-employeeservices-manual</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">docker-employeeservices-manual</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">smlcodes/docker-employeeservices</span>
        <span class="c1"># image: wingtiptoysregistry.azurecr.io/gs-spring-boot-docker:latest</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">docker-employeeservices-manual-service</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">LoadBalancer</span>
  <span class="na">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
    <span class="na">targetPort</span><span class="pi">:</span> <span class="m">8080</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">docker-employeeservices-manual</span>
</code></pre></div></div>

<p><br /></p>

<p>Build Pipeline</p>

<p><img src="media/dd1af48fa8d0a9afc4c624f55758d484.png" alt="" /></p>

<p><br /></p>

<p>Build Is Success, But if you see AKS Cluster it is unable to Pull the
Image<img src="media/d033cc8415f503b5540dc56e62d81ac1.png" alt="" /></p>

<p><br /></p>

<p>Here we can see that AKS is not able to pull image from ACR. Let’s describe the
pod and look for more information.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get pods
docker-employeeservices-acs-86b4879d-7h5x5        0/1     ImagePullBackOff   0          16h
docker-employeeservices-acs-86b4879d-b4zc2        0/1     ImagePullBackOff   0          16h
</code></pre></div></div>

<p><br /></p>

<p><strong>kubectl describe pods</strong> <strong>docker-employeeservices-acs-86b4879d-7h5x5</strong>
<img src="media/69e43dbdda954ef0aad4e205f9d3ec08.png" alt="" /></p>

<p>Here the Problem is ACS &amp; AKS Integration. For that we need to run below command</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az aks update -n myAKSCluster -g myResourceGroup --attach-acr &lt;acr-name&gt;

az aks update -n satyajohnnyAKSCluster -g myResourceGroup --attach-acr satyajohnnycontainer
</code></pre></div></div>

<p><img src="media/f240928f64974ca8d0fa39aa39973151.png" alt="" /></p>

<p><br /></p>

<p>When we attach ACR to AKS, it actually grants the ‘acrpull’ role assignment to
ACR specified by name or resource ID. Check Integration Status</p>

<p><code class="language-plaintext highlighter-rouge">az aks check-acr --name satyajohnnyAKSCluster --resource-group myResourceGroup
\--acr satyajohnnycontainer.azurecr.io</code></p>

<p><img src="media/3e70337ecde081d871e6429fe36a2bc9.png" alt="" /></p>

<p>Re-Run Pipeline Again.</p>

<p><br /></p>

<p><br /></p>

<h2 id="7-verify-deployments-to-k8s">7. Verify deployments to K8S</h2>

<p><code class="language-plaintext highlighter-rouge">kubectl get pods</code></p>

<p><img src="media/a087ae8840870f8c392b363a3c864feb.png" alt="" /></p>

<p><code class="language-plaintext highlighter-rouge">kubectl get deployments</code></p>

<p><img src="media/476c26c601e608e7494da8f6110c782f.png" alt="" /></p>

<p><code class="language-plaintext highlighter-rouge">kubectl get services</code></p>

<p><img src="media/d056ca955c1654ddb3d8f4e1cc085f69.png" alt="" /></p>

<p>Here <strong>External-IP</strong> is the Public IP Where we can access Our Application. You
can also get from UI, Go to AKS Portal in below Image</p>

<p><img src="media/f8ddbde9a0ae00c53692fb9c346da84c.png" alt="" /></p>

<p>Check Pods are Running<img src="media/3001ee30dbc45dcba94bc02ed0c37de2.png" alt="" /></p>

<p>open public IP <strong>without port</strong></p>

<p><img src="media/8a4fc1b8c7d37f3898d82711e359e100.png" alt="" /></p>

<p><br /></p>

<p><br /></p>

<h2 id="8-final-working-pipeline-code">8. Final Working Pipeline Code</h2>

<p>// Dockerfile</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="n">Image</span> <span class="n">based</span> <span class="n">on</span> <span class="n">JAVA</span> <span class="n">Container</span>
<span class="n">FROM</span> <span class="n">openjdk</span><span class="o">:</span><span class="m">8</span><span class="o">-</span><span class="n">jdk</span><span class="o">-</span><span class="n">alpine</span>
<span class="n">ARG</span> <span class="n">JAR_FILE</span><span class="o">=</span><span class="n">target</span><span class="o">/*.</span><span class="n">jar</span>
<span class="n">COPY</span> <span class="err">$</span><span class="p">{</span><span class="n">JAR_FILE</span><span class="p">}</span> <span class="n">Docker</span><span class="o">-</span><span class="n">EmployeeServices</span><span class="o">-</span><span class="m">2.0</span><span class="o">.</span><span class="n">jar</span>
<span class="n">EXPOSE</span> <span class="m">8080</span>
<span class="n">ENTRYPOINT</span> <span class="p">[</span><span class="s">"java"</span><span class="p">,</span><span class="s">"-jar"</span><span class="p">,</span><span class="s">"/Docker-EmployeeServices-2.0.jar"</span><span class="p">]</span>
</code></pre></div></div>

<p><br /></p>

<p>// Jenkinsfile</p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">pipeline</span> <span class="p">{</span>

    <span class="n">environment</span> <span class="p">{</span>
    	
        <span class="n">dockerregistry</span> <span class="o">=</span> <span class="s">"smlcodes/docker-employeeservices"</span>
        <span class="n">dockercreds</span> <span class="o">=</span> <span class="err">'</span><span class="n">docker</span><span class="o">-</span><span class="n">creds</span><span class="err">'</span>
        <span class="n">dockerHubImage</span> <span class="o">=</span> <span class="err">''</span>
        
        <span class="c">//Go to Access Keys in Container Registry and enable the admin user, then use the autogenerated credentials to login via Docker</span>
        <span class="n">azureregistry</span> <span class="o">=</span> <span class="s">"satyajohnnycontainer.azurecr.io"</span>
        <span class="n">azurecreds</span> <span class="o">=</span> <span class="err">'</span><span class="n">azurecontainer</span><span class="o">-</span><span class="n">creds</span><span class="err">'</span>
        <span class="n">azureImage</span> <span class="o">=</span> <span class="err">''</span>              
    <span class="p">}</span>
    
    
    <span class="n">agent</span> 

    <span class="n">tools</span> <span class="p">{</span>
        <span class="c">//Java, Maven Configured in Globol tools configuration. and here the names we provided for configuration</span>
         <span class="err">'</span><span class="n">Java8</span><span class="err">'</span>
         <span class="err">'</span><span class="n">Maven</span><span class="err">'</span>
    <span class="p">}</span>
    
    
    
    <span class="n">stages</span> <span class="p">{</span>
        <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">Clone</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>
                <span class="c">//github-creds are github login creds, configured in Credencial Manager </span>
                <span class="n">git</span> <span class="n">branch</span><span class="o">:</span> <span class="err">'</span><span class="n">main</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">credentialsId</span><span class="o">:</span> <span class="err">'</span><span class="n">github</span><span class="o">-</span><span class="n">creds</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">url</span><span class="o">:</span> <span class="err">'</span><span class="n">https</span><span class="o">:</span><span class="c">//github.com/smlcodes/docker-springboot-employeeservices.git'</span>

            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c">/* 
                    Artifactory-1 - similarly like Globol tool configuration. 
                    				But we are configured manually, passed as ServerID
                    				
                    rtMavenResolver - To get Jars of Pom.xml	
                    rtMavenDeployer - To Deploy Newly created jars on Build			
            */</span>
        <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">Artifactory</span> <span class="n">Configuration</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>

                <span class="n">rtServer</span><span class="p">(</span>
                    <span class="o">:</span> <span class="err">'</span><span class="n">Artifactory</span><span class="o">-</span><span class="m">1</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">url</span><span class="o">:</span> <span class="s">"https://satyajohnny.jfrog.io/artifactory"</span><span class="p">,</span>
                    <span class="n">credentialsId</span><span class="o">:</span> <span class="s">"jfrog-creds"</span>
                <span class="p">)</span>

                <span class="n">rtMavenResolver</span><span class="p">(</span>
                    <span class="o">:</span> <span class="err">'</span><span class="n">maven</span><span class="o">-</span><span class="n">resolver</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">serverId</span><span class="o">:</span> <span class="err">'</span><span class="n">Artifactory</span><span class="o">-</span><span class="m">1</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">releaseRepo</span><span class="o">:</span> <span class="err">'</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">snapshotRepo</span><span class="o">:</span> <span class="err">'</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">libs</span><span class="o">-</span><span class="n">snapshot</span><span class="err">'</span>
                <span class="p">)</span>

                <span class="n">rtMavenDeployer</span><span class="p">(</span>
                    <span class="o">:</span> <span class="err">'</span><span class="n">maven</span><span class="o">-</span><span class="n">deployer</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">serverId</span><span class="o">:</span> <span class="err">'</span><span class="n">Artifactory</span><span class="o">-</span><span class="m">1</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">releaseRepo</span><span class="o">:</span> <span class="err">'</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">local</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">snapshotRepo</span><span class="o">:</span> <span class="err">'</span><span class="n">libs</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">libs</span><span class="o">-</span><span class="n">snapshot</span><span class="o">-</span><span class="n">local</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">threads</span><span class="o">:</span> <span class="m">6</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">Build</span> <span class="n">Maven</span> <span class="n">Project</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>
                <span class="n">rtMavenRun</span><span class="p">(</span>
                    <span class="n">tool</span><span class="o">:</span> <span class="err">'</span><span class="n">Maven</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">pom</span><span class="o">:</span> <span class="err">'</span><span class="n">pom</span><span class="o">.</span><span class="n">xml</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">goals</span><span class="o">:</span> <span class="err">'</span><span class="o">-</span><span class="n">U</span> <span class="n">clean</span> <span class="n">install</span><span class="err">'</span><span class="p">,</span>
                    <span class="n">deployerId</span><span class="o">:</span> <span class="s">"maven-deployer"</span><span class="p">,</span>
                    <span class="n">resolverId</span><span class="o">:</span> <span class="s">"maven-resolver"</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">Build</span> <span class="n">Docker</span> <span class="n">Image</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>

                 <span class="s">"</span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s"> ******************************************************************************"</span>
                 <span class="s">"         Build Docker Image"</span>
                 <span class="s">"******************************************************************************</span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s">"</span>

                <span class="n">script</span> <span class="p">{</span>
                    <span class="c">//docker.build("satyajohnny.jfrog.io/" + "docker-employeeservices:2.0.${env.BUILD_NUMBER}")</span>
                    <span class="n">dockerHubImage</span> <span class="o">=</span> <span class="n">docker</span><span class="o">.</span><span class="n">build</span> <span class="n">dockerregistry</span> <span class="o">+</span> <span class="s">":$BUILD_NUMBER"</span>
                    <span class="n">azureImage</span> <span class="o">=</span> <span class="n">docker</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="s">"satyajohnnycontainer.azurecr.io/"</span> <span class="o">+</span> <span class="s">"docker-employeeservices:${env.BUILD_NUMBER}"</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>


        
           <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">Push</span> <span class="n">Image</span> <span class="n">to</span> <span class="n">Azure</span> <span class="n">Container</span> <span class="n">Registry</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>
                <span class="n">script</span> <span class="p">{</span>

                     <span class="s">"</span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s"> ******************************************************************************"</span>
                     <span class="s">"         Push Image to Azure Container Registry"</span>
                     <span class="s">"******************************************************************************</span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s">"</span>
                    <span class="n">docker</span><span class="o">.</span><span class="n">withRegistry</span><span class="p">(</span><span class="err">'</span><span class="n">https</span><span class="o">:</span><span class="c">//satyajohnnycontainer.azurecr.io', azurecreds) {</span>
                        <span class="n">azureImage</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
                        <span class="n">azureImage</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="err">'</span><span class="n">latest</span><span class="err">'</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
      
       <span class="c">// Uploading Docker images into Docker Hub</span>
        <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">Push</span> <span class="n">Image</span> <span class="n">to</span> <span class="n">Docker</span> <span class="n">HUB</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>
                <span class="n">script</span> <span class="p">{</span>
                    <span class="n">docker</span><span class="o">.</span><span class="n">withRegistry</span><span class="p">(</span><span class="err">''</span><span class="p">,</span> <span class="n">dockercreds</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">dockerHubImage</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
                        <span class="n">dockerHubImage</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="err">'</span><span class="n">latest</span><span class="err">'</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        
       <span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">Remove</span> <span class="n">Unused</span> <span class="n">docker</span> <span class="n">image</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>
                 <span class="s">"docker rmi $dockerregistry:$BUILD_NUMBER"</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="c">// Deploy To Azure Kubernetes Cluster</span>
 		<span class="n">stage</span><span class="p">(</span><span class="err">'</span><span class="n">K8S</span> <span class="n">Deploy</span><span class="err">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>
                <span class="n">script</span> <span class="p">{</span>
                    <span class="n">kubernetesDeploy</span><span class="p">(</span>
                        <span class="n">configs</span><span class="o">:</span> <span class="err">'</span><span class="n">Kubernetes</span><span class="o">.</span><span class="n">yaml</span><span class="err">'</span><span class="p">,</span>
                        <span class="n">kubeconfigId</span><span class="o">:</span> <span class="err">'</span><span class="n">aks</span><span class="o">-</span><span class="n">creds</span><span class="err">'</span><span class="p">,</span>
                        <span class="n">enableConfigSubstitution</span><span class="o">:</span> <span class="no">true</span>
                    <span class="p">)</span>

                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span> 
		        
		        

		        

	<span class="c">/*
	Push Image to Artfifactory Not Woking
	serverId : Configred Artfifactory Server Name
	host : docker daemon host where  Docker currenlty running system/localhost  
	targetRepo :  Repo name in Artfifactory
	*/</span>
 
 <span class="c">/*    
       stage ('Push Image to Artifactory') {
            steps {
			echo "\n \n \n \n ******************************************************************************"
            echo "       Not Working on LocalHost :   Push Docker Image to Artifactory"
            echo "******************************************************************************\n \n \n"
                rtDockerPush(
                    serverId: "Artifactory-1",
                    image: "satyajohnny.jfrog.io/" + "docker-employeeservices:2.0.${env.BUILD_NUMBER}",
					 host: 'tcp://thedockerhost:2375/',
                    targetRepo: 'jenkins-docker-images',
                    properties: 'project-name=docker-employeeservices:2.0;status=stable'
                )
          }
        }
  */</span>      

<span class="c">/*
        stage('Push Image to DockerHub') {
            steps {
                script {

                    echo "\n \n \n \n ******************************************************************************"
                    echo "         Working - Push Image to DockerHub"
                    echo "******************************************************************************\n \n \n"
                    docker.withRegistry('', dockercreds) {
                        dockerHubImage.push()
                    }
                }
            }
        }
  */</span>      





    <span class="p">}</span> <span class="c">//Stages End</span>

<span class="p">}</span> <span class="c">//Pipeline End</span>

<span class="n">always</span> <span class="p">{</span>
    <span class="c">// remove built docker image and prune system</span>
    <span class="nb">print</span> <span class="err">'</span><span class="n">Cleaning</span> <span class="n">up</span> <span class="n">the</span> <span class="n">Docker</span> <span class="n">system</span><span class="o">.</span><span class="err">'</span>
     <span class="err">'</span><span class="n">docker</span> <span class="n">system</span> <span class="n">prune</span> <span class="o">-</span><span class="n">f</span><span class="err">'</span>
<span class="p">}</span>
</code></pre></div></div>

<p><br /></p>

<p>Kubernetes.yaml</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">docker-employeeservices-acs</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">2</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">docker-employeeservices-acs</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">docker-employeeservices-acs</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">docker-employeeservices-acs</span>       
        <span class="na">image</span><span class="pi">:</span> <span class="s">satyajohnnycontainer.azurecr.io/docker-employeeservices:latest</span>
        <span class="c1">#image: smlcodes/docker-employeeservices</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">docker-employeeservices-acs-service</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">LoadBalancer</span>
  <span class="na">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
    <span class="na">targetPort</span><span class="pi">:</span> <span class="m">8080</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">docker-employeeservices-acs</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="9-delete-cluster">9. Delete Cluster</h2>

<p>To avoid Azure charges, you should clean up unneeded resources. When the cluster
is no longer needed, use the az group delete command to remove the resource
group, container service, and all related resources.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az group delete --name myResourceGroup --yes --no-wait
</code></pre></div></div>

<h2 id="ref">Ref.</h2>

<ul>
  <li>
    <p><a href="https://www.coachdevops.com/2020/06/deploy-python-app-into-kubernetes.html">https://www.coachdevops.com/2020/06/deploy-python-app-into-kubernetes.html</a></p>
  </li>
  <li>
    <p><a href="https://docs.microsoft.com/en-us/azure/mysql/quickstart-create-mysql-server-database-using-azure-portal">https://docs.microsoft.com/en-us/azure/mysql/quickstart-create-mysql-server-database-using-azure-portal</a></p>
  </li>
  <li>
    <p><a href="https://reflectoring.io/spring-boot-docker/">https://reflectoring.io/spring-boot-docker/</a></p>
  </li>
  <li>
    <p><a href="https://medium.com/swlh/build-a-docker-image-using-maven-and-spring-boot-58147045a400">https://medium.com/swlh/build-a-docker-image-using-maven-and-spring-boot-58147045a400</a></p>
  </li>
  <li>
    <p><a href="https://medium.com/@gustavo.guss/jenkins-building-docker-image-and-sending-to-registry-64b84ea45ee9">https://medium.com/@gustavo.guss/jenkins-building-docker-image-and-sending-to-registry-64b84ea45ee9</a></p>
  </li>
  <li>
    <p><a href="https://docs.microsoft.com/en-us/azure/container-registry/container-registry-get-started-portal">https://docs.microsoft.com/en-us/azure/container-registry/container-registry-get-started-portal</a></p>
  </li>
  <li>
    <p><a href="https://jfrog.com/blog/ci-cd-side-by-side-jenkins-and-jfrog-pipelines/">https://jfrog.com/blog/ci-cd-side-by-side-jenkins-and-jfrog-pipelines/</a></p>
  </li>
  <li>
    <p><a href="https://www.jfrog.com/confluence/display/JFROG/Declarative+Pipeline+Syntax">https://www.jfrog.com/confluence/display/JFROG/Declarative+Pipeline+Syntax</a></p>
  </li>
  <li>
    <p><a href="https://technology.amis.nl/languages/java-languages/jenkins-building-java-and-deploying-to-kubernetes/">https://technology.amis.nl/languages/java-languages/jenkins-building-java-and-deploying-to-kubernetes/</a></p>
  </li>
  <li>
    <p><a href="https://github.com/talitz/spring-petclinic-ci-cd-k8s-example/blob/master/Jenkinsfile">https://github.com/talitz/spring-petclinic-ci-cd-k8s-example/blob/master/Jenkinsfile</a></p>
  </li>
  <li>
    <p><a href="https://dzone.com/articles/building-docker-images-to-docker-hub-using-jenkins">https://dzone.com/articles/building-docker-images-to-docker-hub-using-jenkins</a></p>
  </li>
  <li>
    <p><a href="https://stackoverflow.com/questions/58203820/jenkins-with-jfrog-artifactory-push-docker-images">https://stackoverflow.com/questions/58203820/jenkins-with-jfrog-artifactory-push-docker-images</a></p>
  </li>
  <li>
    <p><a href="https://stackoverflow.com/questions/50022357/can-not-push-docker-image-to-artifactory-in-jenkins-pipeline-using-artifactory-p">https://stackoverflow.com/questions/50022357/can-not-push-docker-image-to-artifactory-in-jenkins-pipeline-using-artifactory-p</a></p>
  </li>
  <li>
    <p><a href="https://github.com/dumindarw/reactive-eventservice/blob/master/Jenkinsfile">https://github.com/dumindarw/reactive-eventservice/blob/master/Jenkinsfile</a></p>
  </li>
  <li>
    <p><a href="https://github.com/learnk8s/free-kubernetes">https://github.com/learnk8s/free-kubernetes</a></p>
  </li>
  <li>
    <p><a href="https://docs.microsoft.com/en-us/azure/architecture/solution-ideas/articles/container-cicd-using-jenkins-and-kubernetes-on-azure-container-service">https://docs.microsoft.com/en-us/azure/architecture/solution-ideas/articles/container-cicd-using-jenkins-and-kubernetes-on-azure-container-service</a></p>
  </li>
  <li>
    <p><a href="https://ystatit.medium.com/azure-configure-acr-integration-for-existing-aks-cluster-c551c678fede">https://ystatit.medium.com/azure-configure-acr-integration-for-existing-aks-cluster-c551c678fede</a></p>
  </li>
  <li>
    <p><a href="https://github.com/dumindarw/reactive-eventservice/blob/master/Jenkinsfile">https://github.com/dumindarw/reactive-eventservice/blob/master/Jenkinsfile</a></p>
  </li>
  <li>
    <p><a href="https://github.com/learnk8s/free-kubernetes">https://github.com/learnk8s/free-kubernetes</a></p>
  </li>
  <li>
    <p><a href="https://docs.microsoft.com/en-us/azure/architecture/solution-ideas/articles/container-cicd-using-jenkins-and-kubernetes-on-azure-container-service">https://docs.microsoft.com/en-us/azure/architecture/solution-ideas/articles/container-cicd-using-jenkins-and-kubernetes-on-azure-container-service</a></p>
  </li>
</ul>
</div><section class="article__sharing d-print-none"><!-- Addthis BEGIN --><script type="text/javascript"
    src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5dd2bcde40b385b7"></script>
  <div class="addthis_inline_share_toolbox addthis_default_style"></div><!-- Addthis END -->
</section><div class="d-print-none"><footer class="article__footer"><meta itemprop="dateModified" content="2021-08-11T08:00:00+00:00"><!-- start custom article footer snippet -->

<!-- end custom article footer snippet --></footer><div class="article__section-navigator clearfix"><div class="previous"><span>PREVIOUS</span><a href="/Jenkins-Docker-Image-Docker-Hub-AKS.html">Jenkins – Docker Image + Docker Hub + AKS (Azure Kubernetes Service)</a></div><div class="next"><span>NEXT</span><a href="/Implemeting-Single-Sign-On-Using-IBM-Stack.html">Implemeting Single Sign-on using IBM Stack</a></div></div></div>

</div>

<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    $(function() {
      var $this ,$scroll;
      var $articleContent = $('.js-article-content');
      var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
      var scroll = hasSidebar ? '.js-page-main' : 'html, body';
      $scroll = $(scroll);

      $articleContent.find('.highlight').each(function() {
        $this = $(this);
        $this.attr('data-lang', $this.find('code').attr('data-lang'));
      });
      $articleContent.find('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]').each(function() {
        $this = $(this);
        $this.append($('<a class="anchor d-print-none" aria-hidden="true"></a>').html('<i class="fas fa-anchor"></i>'));
      });
      $articleContent.on('click', '.anchor', function() {
        $scroll.scrollToAnchor('#' + $(this).parent().attr('id'), 400);
      });
    });
  });
})();
//alert('start .......');
document.getElementsByClassName('article__header')[0].style.display = 'none';
document.getElementsByClassName('article__info')[0].style.display = 'none';
//alert(' end .......');
 
 document.onreadystatechange = function(){
     if(document.readyState === 'complete'){
         /*code here*/
		 //alert('onreadystatechange comled ... start .......');
document.getElementsByClassName('article__header')[0].style.display = 'none';
document.getElementsByClassName('article__info')[0].style.display = 'none';
//alert('onreadystatechange comled ... end .......');
     }
}

</script></div><section class="page__comments d-print-none"></section></article><!-- start custom main bottom snippet -->

<!-- end custom main bottom snippet --></div>
            </div></div></div><div class="page__footer d-print-none"><footer class="footer py-4 js-page-footer">
  <div class="main"><div itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Satya Kaveti"><meta itemprop="url" content="/"><meta itemprop="description" content="I am an amazing person."><div class="footer__author-links"><div class="author-links">
  <ul class="menu menu--nowrap menu--inline"></ul>
</div>
</div>
    </div><div class="site-info mt-2">
      <div>© SatyaCodes 2020 ,
        <a title="Satya Kaveti" href="about/">Satya Kaveti's Writing</a>.
		<span>| <a href="about/">About Me</a> &nbsp |  </span>
		<span><a href="/terms.html">Terms</a> &nbsp |  </span>
		<span><a href="/contact.html">Contact</a> &nbsp |  </span>
		<span><a href="http://www.satyacodesapps.ml/" target="_blank">Our Apps</a> &nbsp |  </span>
		<span><a href="https://www.facebook.com/isatyakaveti" target="_blank"><i class="fab fa-facebook-f"></i></a> &nbsp |  </span>
		<span><a href="https://www.youtube.com/" target="_blank"><i class="fab fa-youtube-square"></i></a> &nbsp |  </span>
		<span><a href="https://in.linkedin.com/in/satyakaveti"target="_blank"><i class="fab fa-linkedin-in"></i></a> &nbsp | 
		<span>[ 
		<!-- Start of WebFreeCounter Code -->
<a href="http://www.statworker.com/" target="_blank"><img src="https://www.webfreecounter.com/hit.php?id=gfpapx&nd=7&style=2" border="0" alt="statworker.com"></a>
<!-- End of WebFreeCounter Code -->
</span>
<span><a href="https://statcounter.com/p12408441/?guest=1" target="_blank"> ]</a></span>


      </div>
    </div>
  </div>
</footer></div></div>
    </div><script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $body = $('body'), $window = $(window);
    var $pageRoot = $('.js-page-root'), $pageMain = $('.js-page-main');
    var activeCount = 0;
    function modal(options) {
      var $root = this, visible, onChange, hideWhenWindowScroll = false;
      var scrollTop;
      function setOptions(options) {
        var _options = options || {};
        visible = _options.initialVisible === undefined ? false : show;
        onChange = _options.onChange;
        hideWhenWindowScroll = _options.hideWhenWindowScroll;
      }
      function init() {
        setState(visible);
      }
      function setState(isShow) {
        if (isShow === visible) {
          return;
        }
        visible = isShow;
        if (visible) {
          activeCount++;
          scrollTop = $(window).scrollTop() || $pageMain.scrollTop();
          $root.addClass('modal--show');
          $pageMain.scrollTop(scrollTop);
          activeCount === 1 && ($pageRoot.addClass('show-modal'), $body.addClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.on('scroll', hide);
          $window.on('keyup', handleKeyup);
        } else {
          activeCount > 0 && activeCount--;
          $root.removeClass('modal--show');
          $window.scrollTop(scrollTop);
          activeCount === 0 && ($pageRoot.removeClass('show-modal'), $body.removeClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.off('scroll', hide);
          $window.off('keyup', handleKeyup);
        }
        onChange && onChange(visible);
      }
      function show() {
        setState(true);
      }
      function hide() {
        setState(false);
      }
      function handleKeyup(e) {
        // Char Code: 27  ESC
        if (e.which ===  27) {
          hide();
        }
      }
      setOptions(options);
      init();
      return {
        show: show,
        hide: hide,
        $el: $root
      };
    }
    $.fn.modal = modal;
  });
})();
</script><div class="modal modal--overflow page__search-modal d-print-none js-page-search-modal"><script>
(function () {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    // search panel
    var search = (window.search || (window.search = {}));
    var useDefaultSearchBox = window.useDefaultSearchBox === undefined ?
      true : window.useDefaultSearchBox ;

    var $searchModal = $('.js-page-search-modal');
    var $searchToggle = $('.js-search-toggle');
    var searchModal = $searchModal.modal({ onChange: handleModalChange, hideWhenWindowScroll: true });
    var modalVisible = false;
    search.searchModal = searchModal;

    var $searchBox = null;
    var $searchInput = null;
    var $searchClear = null;

    function getModalVisible() {
      return modalVisible;
    }
    search.getModalVisible = getModalVisible;

    function handleModalChange(visible) {
      modalVisible = visible;
      if (visible) {
        search.onShow && search.onShow();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].focus();
      } else {
        search.onShow && search.onHide();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].blur();
        setTimeout(function() {
          useDefaultSearchBox && ($searchInput.val(''), $searchBox.removeClass('not-empty'));
          search.clear && search.clear();
          window.pageAsideAffix && window.pageAsideAffix.refresh();
        }, 400);
      }
    }

    $searchToggle.on('click', function() {
      modalVisible ? searchModal.hide() : searchModal.show();
    });
    // Char Code: 83  S, 191 /
    $(window).on('keyup', function(e) {
      if (!modalVisible && !window.isFormElement(e.target || e.srcElement) && (e.which === 83 || e.which === 191)) {
        modalVisible || searchModal.show();
      }
    });

    if (useDefaultSearchBox) {
      $searchBox = $('.js-search-box');
      $searchInput = $searchBox.children('input');
      $searchClear = $searchBox.children('.js-icon-clear');
      search.getSearchInput = function() {
        return $searchInput.get(0);
      };
      search.getVal = function() {
        return $searchInput.val();
      };
      search.setVal = function(val) {
        $searchInput.val(val);
      };

      $searchInput.on('focus', function() {
        $(this).addClass('focus');
      });
      $searchInput.on('blur', function() {
        $(this).removeClass('focus');
      });
      $searchInput.on('input', window.throttle(function() {
        var val = $(this).val();
        if (val === '' || typeof val !== 'string') {
          search.clear && search.clear();
        } else {
          $searchBox.addClass('not-empty');
          search.onInputNotEmpty && search.onInputNotEmpty(val);
        }
      }, 400));
      $searchClear.on('click', function() {
        $searchInput.val(''); $searchBox.removeClass('not-empty');
        search.clear && search.clear();
      });
    }
  });
})();
</script><div class="search search--dark">
  <div class="main">
    <div class="search__header">Search</div>
    <div class="search-bar">
      <div class="search-box js-search-box">
        <div class="search-box__icon-search"><i class="fas fa-search"></i></div>
        <input type="text" />
        <div class="search-box__icon-clear js-icon-clear">
          <a><i class="fas fa-times"></i></a>
        </div>
      </div>
      <button class="button button--theme-dark button--pill search__cancel js-search-toggle">
        Cancel</button>
    </div>
    <div class="search-result js-search-result"></div>
  </div>
</div>
<script>var SOURCES = window.TEXT_VARIABLES.sources;
var PAHTS = window.TEXT_VARIABLES.paths;
window.Lazyload.js([SOURCES.jquery, PAHTS.search_js], function() {
  var search = (window.search || (window.search = {}));
  var searchData = window.TEXT_SEARCH_DATA || {};

  function memorize(f) {
    var cache = {};
    return function () {
      var key = Array.prototype.join.call(arguments, ',');
      if (key in cache) return cache[key];
      else return cache[key] = f.apply(this, arguments);
    };
  }

  /// search
  function searchByQuery(query) {
    var i, j, key, keys, cur, _title, result = {};
    keys = Object.keys(searchData);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      for (j = 0; j < searchData[key].length; j++) {
        cur = searchData[key][j], _title = cur.title;
        if ((result[key] === undefined || result[key] && result[key].length < 4 )
          && _title.toLowerCase().indexOf(query.toLowerCase()) >= 0) {
          if (result[key] === undefined) {
            result[key] = [];
          }
          result[key].push(cur);
        }
      }
    }
    return result;
  }

  var renderHeader = memorize(function(header) {
    return $('<p class="search-result__header">' + header + '</p>');
  });

  var renderItem = function(index, title, url) {
    return $('<li class="search-result__item" data-index="' + index + '"><a class="button" href="' + url + '">' + title + '</a></li>');
  };

  function render(data) {
    if (!data) { return null; }
    var $root = $('<ul></ul>'), i, j, key, keys, cur, itemIndex = 0;
    keys = Object.keys(data);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      $root.append(renderHeader(key));
      for (j = 0; j < data[key].length; j++) {
        cur = data[key][j];
        $root.append(renderItem(itemIndex++, cur.title, cur.url));
      }
    }
    return $root;
  }

  // search box
  var $result = $('.js-search-result'), $resultItems;
  var lastActiveIndex, activeIndex;

  function clear() {
    $result.html(null);
    $resultItems = $('.search-result__item'); activeIndex = 0;
  }
  function onInputNotEmpty(val) {
    $result.html(render(searchByQuery(val)));
    $resultItems = $('.search-result__item'); activeIndex = 0;
    $resultItems.eq(0).addClass('active');
  }

  search.clear = clear;
  search.onInputNotEmpty = onInputNotEmpty;

  function updateResultItems() {
    lastActiveIndex >= 0 && $resultItems.eq(lastActiveIndex).removeClass('active');
    activeIndex >= 0 && $resultItems.eq(activeIndex).addClass('active');
  }

  function moveActiveIndex(direction) {
    var itemsCount = $resultItems ? $resultItems.length : 0;
    if (itemsCount > 1) {
      lastActiveIndex = activeIndex;
      if (direction === 'up') {
        activeIndex = (activeIndex - 1 + itemsCount) % itemsCount;
      } else if (direction === 'down') {
        activeIndex = (activeIndex + 1 + itemsCount) % itemsCount;
      }
      updateResultItems();
    }
  }

  // Char Code: 13  Enter, 37  ⬅, 38  ⬆, 39  ➡, 40  ⬇
  $(window).on('keyup', function(e) {
    var modalVisible = search.getModalVisible && search.getModalVisible();
    if (modalVisible) {
      if (e.which === 38) {
        modalVisible && moveActiveIndex('up');
      } else if (e.which === 40) {
        modalVisible && moveActiveIndex('down');
      } else if (e.which === 13) {
        modalVisible && $resultItems && activeIndex >= 0 && $resultItems.eq(activeIndex).children('a')[0].click();
      }
    }
  });

  $result.on('mouseover', '.search-result__item > a', function() {
    var itemIndex = $(this).parent().data('index');
    itemIndex >= 0 && (lastActiveIndex = activeIndex, activeIndex = itemIndex, updateResultItems());
  });
});
</script></div></div>


<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function scrollToAnchor(anchor, duration, callback) {
      var $root = this;
      $root.animate({ scrollTop: $(anchor).position().top }, duration, function() {
        window.history.replaceState(null, '', window.location.href.split('#')[0] + anchor);
        callback && callback();
      });
    }
    $.fn.scrollToAnchor = scrollToAnchor;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function affix(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroll,
        offsetBottom = 0, scrollTarget = window, scroll = window.document, disabled = false, isOverallScroller = true,
        rootTop, rootLeft, rootHeight, scrollBottom, rootBottomTop,
        hasInit = false, curState;

      function setOptions(options) {
        var _options = options || {};
        _options.offsetBottom && (offsetBottom = _options.offsetBottom);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroll && (scroll = _options.scroll);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $scrollTarget = $(scrollTarget);
        isOverallScroller = window.isOverallScroller($scrollTarget[0]);
        $scroll = $(scroll);
      }
      function preCalc() {
        top();
        rootHeight = $root.outerHeight();
        rootTop = $root.offset().top + (isOverallScroller ? 0 :  $scrollTarget.scrollTop());
        rootLeft = $root.offset().left;
      }
      function calc(needPreCalc) {
        needPreCalc && preCalc();
        scrollBottom = $scroll.outerHeight() - offsetBottom - rootHeight;
        rootBottomTop = scrollBottom - rootTop;
      }
      function top() {
        if (curState !== 'top') {
          $root.removeClass('fixed').css({
            left: 0,
            top: 0
          });
          curState = 'top';
        }
      }
      function fixed() {
        if (curState !== 'fixed') {
          $root.addClass('fixed').css({
            left: rootLeft + 'px',
            top: 0
          });
          curState = 'fixed';
        }
      }
      function bottom() {
        if (curState !== 'bottom') {
          $root.removeClass('fixed').css({
            left: 0,
            top: rootBottomTop + 'px'
          });
          curState = 'bottom';
        }
      }
      function setState() {
        var scrollTop = $scrollTarget.scrollTop();
        if (scrollTop >= rootTop && scrollTop <= scrollBottom) {
          fixed();
        } else if (scrollTop < rootTop) {
          top();
        } else {
          bottom();
        }
      }
      function init() {
        if(!hasInit) {
          var interval, timeout;
          calc(true); setState();
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState();
          });
          $window.on('resize', function() {
            disabled || (calc(true), setState());
          });
          hasInit = true;
        }
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions,
        refresh: function() {
          calc(true, { animation: false }); setState();
        }
      };
    }
    $.fn.affix = affix;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function toc(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroller, $tocUl = $('<ul class="toc toc--ellipsis"></ul>'), $tocLi, $headings, $activeLast, $activeCur,
        selectors = 'h1,h2,h3', container = 'body', scrollTarget = window, scroller = 'html, body', disabled = false,
        headingsPos, scrolling = false, hasRendered = false, hasInit = false;

      function setOptions(options) {
        var _options = options || {};
        _options.selectors && (selectors = _options.selectors);
        _options.container && (container = _options.container);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroller && (scroller = _options.scroller);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $headings = $(container).find(selectors).filter('[id]');
        $scrollTarget = $(scrollTarget);
        $scroller = $(scroller);
      }
      function calc() {
        headingsPos = [];
        $headings.each(function() {
          headingsPos.push(Math.floor($(this).position().top));
        });
      }
      function setState(element, disabled) {
        var scrollTop = $scrollTarget.scrollTop(), i;
        if (disabled || !headingsPos || headingsPos.length < 1) { return; }
        if (element) {
          $activeCur = element;
        } else {
          for (i = 0; i < headingsPos.length; i++) {
            if (scrollTop >= headingsPos[i]) {
              $activeCur = $tocLi.eq(i);
            } else {
              $activeCur || ($activeCur = $tocLi.eq(i));
              break;
            }
          }
        }
        $activeLast && $activeLast.removeClass('active');
        ($activeLast = $activeCur).addClass('active');
      }
      function render() {
        if(!hasRendered) {
          $root.append($tocUl);
          $headings.each(function() {
            var $this = $(this);
            $tocUl.append($('<li></li>').addClass('toc-' + $this.prop('tagName').toLowerCase())
              .append($('<a></a>').text($this.text()).attr('href', '#' + $this.prop('id'))));
          });
          $tocLi = $tocUl.children('li');
          $tocUl.on('click', 'a', function(e) {
            e.preventDefault();
            var $this = $(this);
            scrolling = true;
            setState($this.parent());
            $scroller.scrollToAnchor($this.attr('href'), 400, function() {
              scrolling = false;
            });
          });
        }
        hasRendered = true;
      }
      function init() {
        var interval, timeout;
        if(!hasInit) {
          render(); calc(); setState(null, scrolling);
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState(null, scrolling);
          });
          $window.on('resize', window.throttle(function() {
            if (!disabled) {
              render(); calc(); setState(null, scrolling);
            }
          }, 100));
        }
        hasInit = true;
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions
      };
    }
    $.fn.toc = toc;
  });
})();
/*(function () {

})();*/
</script><script>
  /* toc must before affix, since affix need to konw toc' height. */(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  var TOC_SELECTOR = window.TEXT_VARIABLES.site.toc.selectors;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window);
    var $articleContent = $('.js-article-content');
    var $tocRoot = $('.js-toc-root'), $col2 = $('.js-col-aside');
    var toc;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
    var hasToc = $articleContent.find(TOC_SELECTOR).length > 0;

    function disabled() {
      return $col2.css('display') === 'none' || !hasToc;
    }

    tocDisabled = disabled();

    toc = $tocRoot.toc({
      selectors: TOC_SELECTOR,
      container: $articleContent,
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      tocDisabled = disabled();
      toc && toc.setOptions({
        disabled: tocDisabled
      });
    }, 100));

  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window), $pageFooter = $('.js-page-footer');
    var $pageAside = $('.js-page-aside');
    var affix;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');

    affix = $pageAside.affix({
      offsetBottom: $pageFooter.outerHeight(),
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      scroll: hasSidebar ? $('.js-page-main').children() : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      affix && affix.setOptions({
        disabled: tocDisabled
      });
    }, 100));

    window.pageAsideAffix = affix;
  });
})();
</script>
    </div>
    <script>(function () {
  var $root = document.getElementsByClassName('root')[0];
  if (window.hasEvent('touchstart')) {
    $root.dataset.isTouch = true;
    document.addEventListener('touchstart', function(){}, false);
  }
})();
</script>
  </body>
</html>